{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Pr\u00f3logo","text":""},{"location":"#proposito-y-objetivos-de-esta-guia","title":"Prop\u00f3sito y objetivos de esta gu\u00eda","text":"<p>Esta es la gu\u00eda base sobre copias de seguridad de iCarto.</p> <p>Usamos esta gu\u00eda c\u00f3mo punto de partida a partir del cual implementamos estrategias concretas y documentaci\u00f3n adaptadas a cada cliente.</p> <p>El objetivo de esta gu\u00eda es proporcionar pr\u00e1cticas efectivas para implementar sistemas de backup robustos pero sencillos de mantener, con un equilibrio entre seguridad, eficiencia operativa y costes.</p>"},{"location":"#a-quien-va-dirigida","title":"A qui\u00e9n va dirigida","text":"<ul> <li>Equipos IT</li> <li>Clientes interesados en nuestra estrategia de protecci\u00f3n de datos</li> <li>Equipo de iCarto</li> </ul>"},{"location":"#como-utilizar-esta-guia","title":"C\u00f3mo utilizar esta gu\u00eda","text":"<p>Util\u00edcela como documento de referencia para comprender principios generales, implementar soluciones espec\u00edficas y tomar decisiones sobre estrategias de backup. Adapte las recomendaciones a las necesidades particulares de cada proyecto.</p> <p>Esta gu\u00eda se distribuye bajo licencia CC-By. Puede adaptarla a sus necesidades siempre que incluya una referencia a la autor\u00eda original</p>"},{"location":"#contribuye","title":"Contribuye","text":"<p>Si encuentras alg\u00fan error, tienes alguna pregunta o cualquier otra cosa puedes abrir una issue o ponerte en contacto con iCarto.</p>"},{"location":"introduccion/","title":"Introducci\u00f3n a las copias de seguridad","text":""},{"location":"introduccion/#conceptos-fundamentales","title":"Conceptos fundamentales","text":"<p>Una copia de seguridad es una r\u00e9plica de datos almacenada en una ubicaci\u00f3n separada del original para recuperarlos en caso de p\u00e9rdida o corrupci\u00f3n. Los conceptos clave incluyen:</p> <ul> <li>Backup: El proceso de copiar y almacenar datos</li> <li>Restore: El proceso de recuperaci\u00f3n de datos desde las copias</li> <li>RPO (Recovery Point Objective): M\u00e1xima cantidad de datos que se puede perder, medida en tiempo</li> <li>RTO (Recovery Time Objective): Tiempo m\u00e1ximo aceptable para restaurar completamente el sistema</li> <li>Retenci\u00f3n: Per\u00edodo durante el cual se conservan las copias</li> <li>Point in Time Recovery (PITR): Recuperaci\u00f3n de los datos en un punto concreto del tiempo.</li> <li>Full / Incremental / Differential. Si la copia es completa o s\u00f3lo se transmiten los cambios.</li> <li>F\u00edsico / L\u00f3gico. En base de datos hace referencia a almacenar los datos c\u00f3mo SQL o c\u00f3mo ficheros en disco. En sistemas de archivos puede hacer referencia a los ficheros en s\u00ed, o a los bloques (bytes) en el disco.</li> <li>Push / Pull. Si la copia se efect\u00faa desde la fuente al destino o viceversa.</li> <li>Disaster Recovery Plan (DRP). Un Plan de Recuperaci\u00f3n ante Desastres es un conjunto documentado de pol\u00edticas, procedimientos y medidas dise\u00f1adas para restaurar los sistemas de una organizaci\u00f3n despu\u00e9s de un evento.</li> </ul>"},{"location":"introduccion/#importancia-y-necesidad-de-los-backups","title":"Importancia y necesidad de los backups","text":"<p>Los backups son esenciales porque:</p> <ol> <li>Protegen contra p\u00e9rdidas de datos por fallos de hardware, software o errores humanos</li> <li>Permiten recuperarse de ciberataques como ransomware</li> <li>Facilitan migraciones y actualizaciones</li> <li>Son requeridos por normativas (GDPR, LOPD, ...) y compromisos contractuales</li> </ol>"},{"location":"introduccion/#riesgos-y-amenazas-habituales","title":"Riesgos y amenazas habituales","text":"<p>Los principales riesgos que hacen necesarios los backups son:</p> <ul> <li>Fallos de hardware: Sobre todo errores en el disco duro</li> <li>Errores de software: Bugs, actualizaciones fallidas, corrupci\u00f3n de datos</li> <li>Errores humanos: Eliminaci\u00f3n accidental, despliegues destructivos</li> <li>Ataques maliciosos: Ransomware, sabotaje interno/externo</li> <li>Desastres f\u00edsicos: Incendios, inundaciones, problemas el\u00e9ctricos</li> <li>Incidentes en proveedores cloud: Ca\u00eddas de servicios, errores en plataformas</li> </ul>"},{"location":"introduccion/#limitaciones-de-las-copias-de-seguridad","title":"Limitaciones de las copias de seguridad","text":"<p>Aunque potencialmente se puedan usar para ello, las copias de seguridad no son:</p> <ul> <li>Sustitutos de sistemas de alta disponibilidad</li> <li>Mecanismos de sincronizaci\u00f3n o data replication</li> <li>Garant\u00eda absoluta contra todos los riesgos posibles</li> <li>Mecanismos de versionado, gesti\u00f3n de hist\u00f3ricos o audit trail.</li> </ul>"},{"location":"introduccion/#adecuacion-al-riesgo","title":"Adecuaci\u00f3n al riesgo","text":"<p>La estrategia de backup debe adaptarse a los riesgos espec\u00edficos que queremos mitigar:</p> <ul> <li>Contra errores humanos (borrado accidental): Un sistema de snapshots frecuentes puede ser suficiente</li> <li>Contra ransomware: Se requieren backups que no puedan ser alcanzados por el ataque</li> <li>Contra desastres f\u00edsicos: Necesitamos copias en ubicaciones geogr\u00e1ficas distintas</li> <li>Contra fallos de proveedor cloud: Almacenar los backups en otro proveedor</li> </ul> <p>Un cliente que gestiona datos cr\u00edticos necesitar\u00e1 una estrategia m\u00e1s robusta que uno con un blog corporativo. No todos los sistemas requieren protecci\u00f3n m\u00e1xima contra todos los riesgos posibles, lo que permite optimizar costes y complejidad.</p> <p>Una estrategia \"segura\" para servidores de \"oficina\", puede ser conectar un disco duro externo todas las noches a un servidor, ejecutar un script de copia y llevar el disco externo a otra ubicaci\u00f3n segura. Pero \u00bfrealmente existir\u00e1 consistencia en hacer las copias?</p> <p>El sistena de snapshot de un proveedor cloud puede ser muy c\u00f3modo y eficaz. Pero si alguien gana acceso a la cuenta de administraci\u00f3n podr\u00e1 atacar a la vez los datos y las copias.</p>"},{"location":"introduccion/#seguridad-de-las-copias","title":"Seguridad de las copias","text":"<p>Las copias de seguridad, al contener datos potencialmente sensibles, requieren protecci\u00f3n espec\u00edfica:</p> <ul> <li>Control de acceso: Limitar qui\u00e9n puede acceder a los backups mediante autenticaci\u00f3n y permisos</li> <li>Cifrado: Proteger los datos en tr\u00e1nsito y almacenamiento para evitar acceso no autorizado</li> <li>Protecci\u00f3n contra manipulaci\u00f3n: Verificar la integridad de las copias para detectar modificaciones no autorizadas</li> <li>Cumplimiento normativo: Asegurar que la gesti\u00f3n de copias cumple con regulaciones sobre protecci\u00f3n de datos</li> </ul> <p>Un backup comprometido puede suponer una violaci\u00f3n de datos tan grave como un ataque al sistema principal, por lo que su seguridad debe ser proporcional a la sensibilidad de la informaci\u00f3n almacenada.</p>"},{"location":"introduccion/#citas","title":"Citas","text":"<p>Ryan Booz</p> <p>Backups are only as good as your ability to restore the data in the business appropriate timeframe.</p>"},{"location":"anexos/","title":"Anexos","text":"<p>Temas particulares que no se incluyen en las secciones principales.</p>"},{"location":"anexos/retencion_gfs_logaritmica/","title":"Diferencia entre pol\u00edtica logar\u00edtmica y GFS (Grandfather-Father-Son)","text":"<p>Ambas pol\u00edticas de retenci\u00f3n buscan optimizar el equilibrio entre cobertura temporal y uso eficiente del almacenamiento, pero lo hacen con enfoques diferentes.</p>"},{"location":"anexos/retencion_gfs_logaritmica/#estructura-basica","title":"Estructura b\u00e1sica","text":"<p>GFS:</p> <p>Utiliza una estructura jer\u00e1rquica con categor\u00edas claramente definidas:</p> <ul> <li>Son (Hijo): Copias diarias (normalmente 7-14 d\u00edas)</li> <li>Father (Padre): Copias semanales (normalmente 4-5 semanas)</li> <li>Grandfather (Abuelo): Copias mensuales (normalmente 12 meses)</li> <li>A veces se a\u00f1ade una capa adicional de copias anuales</li> </ul> <p>Logar\u00edtmica:</p> <p>Se basa en una distribuci\u00f3n matem\u00e1tica donde la densidad de puntos de restauraci\u00f3n disminuye logar\u00edtmicamente a medida que retrocedemos en el tiempo. No tiene categor\u00edas fijas predefinidas, sino una distribuci\u00f3n continua basada en la antig\u00fcedad de los backups.</p>"},{"location":"anexos/retencion_gfs_logaritmica/#distribucion-temporal","title":"Distribuci\u00f3n temporal","text":"<p>GFS:</p> <p>La distribuci\u00f3n es escalonada y predefinida. Por ejemplo, en un esquema t\u00edpico:</p> <ul> <li>Primeros 14 d\u00edas: Una copia por d\u00eda (14 copias)</li> <li>Siguientes 4 semanas: Una copia por semana (4 copias)</li> <li>Siguientes 12 meses: Una copia por mes (12 copias)</li> </ul> <p>Esto crea \"saltos\" o discontinuidades en la densidad de puntos de restauraci\u00f3n.</p> <p>Logar\u00edtmica:</p> <p>La distribuci\u00f3n sigue una curva logar\u00edtmica continua. La densidad de puntos de restauraci\u00f3n disminuye gradualmente sin saltos bruscos. Por ejemplo:</p> <ul> <li>Primer d\u00eda: 24 copias (una cada hora)</li> <li>Segunda semana: 7 copias (una por d\u00eda)</li> <li>Tercer mes: 4 copias (una por semana)</li> <li>Resto del a\u00f1o: 12 copias (una por mes)</li> </ul>"},{"location":"anexos/retencion_gfs_logaritmica/#criterios-de-seleccion-y-retencion","title":"Criterios de selecci\u00f3n y retenci\u00f3n","text":"<p>GFS:</p> <p>Se basa en reglas fijas para seleccionar qu\u00e9 copias conservar:</p> <ul> <li>\"Conserva el \u00faltimo backup de cada d\u00eda durante X d\u00edas\"</li> <li>\"Conserva el \u00faltimo backup de cada semana durante Y semanas\"</li> <li>\"Conserva el \u00faltimo backup de cada mes durante Z meses\"</li> </ul> <p>La selecci\u00f3n depende de la categor\u00eda temporal (d\u00eda/semana/mes) y se aplica de forma discreta.</p> <p>Logar\u00edtmica:</p> <p>La selecci\u00f3n se basa en una f\u00f3rmula matem\u00e1tica que considera la antig\u00fcedad del backup:</p> <ul> <li>Backups m\u00e1s recientes: Se conservan casi todos</li> <li>Backups m\u00e1s antiguos: Se reduce progresivamente la densidad</li> </ul> <p>A menudo utiliza algoritmos que calculan din\u00e1micamente qu\u00e9 backups mantener para conseguir la distribuci\u00f3n deseada.</p>"},{"location":"anexos/retencion_gfs_logaritmica/#flexibilidad-y-adaptabilidad","title":"Flexibilidad y adaptabilidad","text":"<p>GFS:</p> <ul> <li>Estructura m\u00e1s r\u00edgida y predecible</li> <li>M\u00e1s f\u00e1cil de explicar y visualizar</li> <li>Menos adaptable a necesidades cambiantes</li> <li>Requiere definir expl\u00edcitamente cada nivel de retenci\u00f3n</li> </ul> <p>Logar\u00edtmica:</p> <ul> <li>Estructura m\u00e1s flexible y din\u00e1mica</li> <li>Se adapta mejor a diferentes per\u00edodos sin cambiar la configuraci\u00f3n</li> <li>Puede optimizarse seg\u00fan patrones de acceso y requisitos espec\u00edficos</li> <li>Permite ajustar la \"pendiente\" de la curva logar\u00edtmica seg\u00fan necesidades</li> </ul>"},{"location":"anexos/retencion_gfs_logaritmica/#ejemplo-practico-comparativo","title":"Ejemplo pr\u00e1ctico comparativo","text":"<p>Veamos c\u00f3mo ambas pol\u00edticas distribuir\u00edan puntos de restauraci\u00f3n a lo largo de un a\u00f1o:</p> <p>GFS (esquema t\u00edpico):</p> <ul> <li>\u00daltimos 14 d\u00edas: 14 copias (una diaria)</li> <li>\u00daltimas 4 semanas: 4 copias (una semanal)</li> <li>\u00daltimos 12 meses: 12 copias (una mensual)</li> <li>Total: 30 puntos de restauraci\u00f3n, con distribuci\u00f3n escalonada</li> </ul> <p>Logar\u00edtmica (ejemplo):</p> <ul> <li>\u00daltima semana: 7 copias (una diaria)</li> <li>Segunda semana: 3-4 copias (espaciadas)</li> <li>Tercer y cuarto semana: 2-3 copias</li> <li>Segundo mes: 3-4 copias</li> <li>Meses 3-6: 4-6 copias</li> <li>Meses 7-12: 6 copias</li> <li>Total: aproximadamente 25-30 puntos de restauraci\u00f3n, con distribuci\u00f3n gradual</li> </ul>"},{"location":"anexos/retencion_gfs_logaritmica/#implementacion","title":"Implementaci\u00f3n","text":"<p>GFS:</p> <pre><code># Pseudoc\u00f3digo de reglas GFS\ndef aplicar_politica_gfs(backups):\n    conservar = []\n\n    # Conservar diarios (\u00faltimos 14 d\u00edas)\n    for i in range(14):\n        conservar.append(obtener_backup_del_dia(hoy - i d\u00edas))\n\n    # Conservar semanales (\u00faltimas 4 semanas)\n    for i in range(4):\n        conservar.append(obtener_backup_de_semana(semana_actual - i))\n\n    # Conservar mensuales (\u00faltimos 12 meses)\n    for i in range(12):\n        conservar.append(obtener_backup_de_mes(mes_actual - i))\n\n    return conservar\n</code></pre> <p>Logar\u00edtmica:</p> <pre><code># Pseudoc\u00f3digo de pol\u00edtica logar\u00edtmica\ndef aplicar_politica_logaritmica(backups):\n    conservar = []\n    ahora = fecha_actual()\n\n    for backup in backups:\n        edad_dias = (ahora - backup.fecha).dias\n\n        # F\u00f3rmula logar\u00edtmica para determinar si conservar\n        # M\u00e1s reciente = m\u00e1s probable que se conserve\n        if edad_dias == 0:\n            # Conservar todos los del d\u00eda actual\n            conservar.append(backup)\n        elif edad_dias &lt;= 7:\n            # Conservar 1 por d\u00eda en la \u00faltima semana\n            if es_unico_en_dia(backup):\n                conservar.append(backup)\n        elif edad_dias &lt;= 30:\n            # Para el \u00faltimo mes, densidad decreciente\n            if edad_dias % int(math.log(edad_dias) + 1) == 0:\n                conservar.append(backup)\n        else:\n            # Para per\u00edodos m\u00e1s antiguos\n            if edad_dias % int(math.log(edad_dias) * 2) == 0:\n                conservar.append(backup)\n\n    return conservar\n\n# for edad in range(7, 30):\n#     print(f\"edad {edad} {'conservar' if edad % int(math.log(edad) + 1) == 0 else 'borrar'}\")\n</code></pre>"},{"location":"anexos/retencion_gfs_logaritmica/#ventajas-y-desventajas","title":"Ventajas y desventajas","text":""},{"location":"anexos/retencion_gfs_logaritmica/#gfs","title":"GFS","text":"<p>Ventajas:</p> <ul> <li>F\u00e1cil de entender, comunicar y auditar</li> <li>Simple de implementar con herramientas est\u00e1ndar</li> <li>Ofrece una estructura predecible para los administradores</li> <li>Bien soportada por la mayor\u00eda de herramientas de backup</li> </ul> <p>Desventajas:</p> <ul> <li>Menos eficiente en la distribuci\u00f3n de puntos de restauraci\u00f3n</li> <li>Crea \"saltos\" en la granularidad temporal</li> <li>Menos \u00f3ptima en t\u00e9rminos de uso del almacenamiento</li> <li>Puede requerir m\u00e1s espacio para la misma cobertura temporal</li> </ul>"},{"location":"anexos/retencion_gfs_logaritmica/#logaritmica","title":"Logar\u00edtmica","text":"<p>Ventajas:</p> <ul> <li>Distribuci\u00f3n m\u00e1s eficiente de puntos de restauraci\u00f3n</li> <li>Mayor cobertura temporal con el mismo n\u00famero de backups</li> <li>Transici\u00f3n suave entre diferentes per\u00edodos temporales</li> <li>Mejor optimizaci\u00f3n del espacio utilizado</li> </ul> <p>Desventajas:</p> <ul> <li>M\u00e1s compleja de implementar correctamente</li> <li>Puede ser dif\u00edcil de explicar a stakeholders no t\u00e9cnicos</li> <li>Menos herramientas la soportan nativamente</li> <li>Requiere algoritmos m\u00e1s sofisticados para la selecci\u00f3n y eliminaci\u00f3n</li> </ul>"},{"location":"anexos/retencion_gfs_logaritmica/#cual-elegir","title":"\u00bfCu\u00e1l elegir?","text":"<p>La elecci\u00f3n entre GFS y logar\u00edtmica depende de varios factores:</p> <ul> <li> <p>Requisitos de negocio: Si necesitas puntos de restauraci\u00f3n claramente definidos por per\u00edodos (diario, semanal, mensual), GFS es m\u00e1s directo. Si buscas optimizar el uso del almacenamiento manteniendo buena cobertura temporal, la logar\u00edtmica es mejor.</p> </li> <li> <p>Limitaciones de almacenamiento: La pol\u00edtica logar\u00edtmica suele ser m\u00e1s eficiente en t\u00e9rminos de espacio para longitudes similares de historia.</p> </li> <li> <p>Herramientas disponibles: GFS est\u00e1 ampliamente soportado, mientras que la logar\u00edtmica puede requerir implementaci\u00f3n personalizada.</p> </li> <li> <p>Complejidad aceptable: GFS es m\u00e1s sencillo de implementar y verificar; la logar\u00edtmica requiere algoritmos m\u00e1s sofisticados.</p> </li> <li> <p>Patrones de acceso: Si los datos recientes se acceden con mucha m\u00e1s frecuencia, la pol\u00edtica logar\u00edtmica se alinea mejor con estos patrones de uso.</p> </li> </ul> <p>Una combinaci\u00f3n h\u00edbrida tambi\u00e9n es posible, utilizando una retenci\u00f3n casi continua para el pasado reciente (similar a la logar\u00edtmica) y luego aplicando reglas GFS para per\u00edodos m\u00e1s antiguos.</p>"},{"location":"herramientas/","title":"Herramientas y Tecnolog\u00edas","text":"<p>La selecci\u00f3n de herramientas adecuadas es fundamental para implementar una estrategia de backup efectiva.</p> <p>En las siguientes secciones se presentan algunas de estas herramientas sabiendo que:</p> <ul> <li>No es posible dar un listado exhaustivo, si no \u00fanicamente uno representativo que refleje las opciones del mercado</li> <li>Consideramos imprescindible que sean soluciones de sw libre, preferiblemente con opciones de soporte profesional</li> <li>Las herramientas evolucionan r\u00e1pidamente y lo que se diga de ellas puede quedar desactualizado pronto</li> <li>No hemos probado todas las herramientas citadas</li> </ul>"},{"location":"herramientas/automatizacion_monitorizacion/","title":"Herramientas de Monitorizaci\u00f3n y Automatizaci\u00f3n","text":"<p>Si bien pueden existir herramientas espec\u00edficas de automatizaci\u00f3n y monitorizaci\u00f3n para los backups cualquier herramienta generalista de este \u00e1mbito en la que el equipo tenga experiencia es una opci\u00f3n v\u00e1lida.</p> <p>En el caso de las suites de backup la monitorizaci\u00f3n suele venir inclu\u00edda en la propia herramienta.</p> <p>Si se usan herramientas m\u00e1s generalistas c\u00f3mo rsync la responsabilidad cae del lado de quien implemente la soluci\u00f3n.</p> <p>Otras herramientas c\u00f3mo Borgmatic est\u00e1n ya preparadas para ser integradas en entornos de monitorizaci\u00f3n c\u00f3mo healthchecks.io, loki o Sentry.</p> <p>Tambi\u00e9n es habitual encontrar roles de Ansible que permiten el despliegue de estas herramientas.</p>"},{"location":"herramientas/automatizacion_monitorizacion/#ejemplos","title":"Ejemplos","text":"<ul> <li>Integraci\u00f3n de Borgmatic con servicios de monitorizaci\u00f3n</li> <li>Role de Ansible para Borgmatic</li> </ul>"},{"location":"herramientas/postgresql/","title":"Herramientas de backup para PostgreSQL","text":"<p>Hay decenas de herramientas para realizar copias de seguridad de PostgreSQL.</p> <ul> <li>Listado de herramientas</li> <li>Resumen de tecnolog\u00edas de backup para PostgreSQL</li> <li>Diferencia entre Alta Disponibilidad y Recuperaci\u00f3n ante Desastres</li> </ul> <p>Las m\u00e1s usadas son:</p> <ul> <li>pg_dump / pg_dumpall</li> <li>pg_basebackup</li> <li>pgBackRest</li> <li>barman</li> </ul> <p>Otras herramientas con menos tracci\u00f3n pero que pueden encajar en algunos casos de uso son:</p> <ul> <li>https://github.com/postgrespro/pg_probackup</li> <li>https://github.com/ossc-db/pg_rman</li> <li>https://github.com/pgmoneta/pgmoneta</li> <li>https://github.com/Aiven-Open/pghoard</li> <li>https://github.com/wal-g/wal-g</li> </ul>"},{"location":"herramientas/postgresql/#pg_dump-pg_dumpall","title":"pg_dump / pg_dumpall","text":"<p>Hay quien considera que pg_dump no es una herramienta de backup. Nosotros las inclu\u00edmos en el tipo de backups l\u00f3gicos.</p> <p>pg_dump admite muchas opciones que lo hacen flexible:</p> <ul> <li> <p>Formato: custom/plain/tar/directory.</p> <ul> <li><code>plain</code> Generan un fichero .sql. No se deber\u00edan usar para backups.</li> <li><code>tar</code> No se deber\u00eda usar para backups porqu\u00e9 es poco flexible.</li> <li><code>custom</code> es la mejor opci\u00f3n para bases de datos peque\u00f1as (&lt; 10GB) o donde el tiempo de backup/restore no sea fundamental. El dump se puede manipular (tabla de contenidos, ...) antes del restore.</li> <li><code>directory</code> m\u00e1s incomodo que custom porqu\u00e9 genera un fichero separado por cada tabla y blob. Permite lanzar varios procesos en paralelo con la opci\u00f3n <code>-j</code> tanto en backup como en restore, mejorando la velocidad. El resultado se puede pasar luego a <code>tar</code> para gestionar un s\u00f3lo archivo.</li> </ul> </li> <li> <p>Selectividad. Tiene opciones para excluir o incluir patrones de tablas y esquemas, blobs, contenido y/o esquema, ...</p> </li> </ul> <p>pg_dump trabaja a nivel base de datos no a nivel cluster. Para exportar objetos que pertenecen al cluster (sobre todo usuarios) debe emplearse <code>pg_dumpall</code>. <code>pg_dumpall</code> es menos flexible que <code>pg_dump</code> por lo que ambas herramientas deben combinarse.</p> <p>El sistema de copia debe tener en cuenta:</p> <ul> <li>Gestionar la copia a trav\u00e9s de un script, generalmente en bash y programado mediante cron o systemd</li> <li>Permisos de acceso a la base de datos (red y usuarios)</li> <li>La retenci\u00f3n deben hacerse mediante la fecha o nombre de los archivos</li> <li>Debe pensarse bien la estrategia de push / pull</li> </ul>"},{"location":"herramientas/postgresql/#pg_basebackup","title":"pg_basebackup","text":"<p>Es una herramienta de \"backup f\u00edsico\" nativa de PostgreSQL. Combin\u00e1ndola con WAL permite PITR.</p> <p>Funciona a nivel cluster y sistema de ficheros. No permite \"seleccionar\" lo que se quiere copiar, ni necesita \"permisos\" en PostgreSQL.</p> <p>El sistema de copia debe realizarse a trav\u00e9s de un script que tenga en cuenta los problemas habituales y mover el archivo al servidor de backups.</p> <ul> <li>Ejemplo de uso de <code>pg_basebackup</code> con PITR mediante WAL y script programado con systemd</li> <li>A partir de la versi\u00f3n 17 los backups pueden ser incrementales o diferenciales de forma nativa:<ul> <li>Incremental Backups in PostgreSQL 17</li> <li>Waiting for PostgreSQL 17 \u2013 Add support for incremental backup</li> </ul> </li> </ul>"},{"location":"herramientas/postgresql/#pgbackrest-y-barman","title":"pgBackRest y Barman","text":"<p>Ambas son dos buenas herramientas, cada una con sus caracter\u00edsticas. Cada una mantenido por una empresa distinta.</p> <ul> <li>pgbackrest vs pgbarman</li> </ul>"},{"location":"herramientas/postgresql/#pgbackrest","title":"pgbackrest","text":"<ul> <li>https://pgbackrest.org/</li> <li>http://www.pgdba.org/post/fun_pgbackrest/</li> <li>https://www.percona.com/blog/pgbackrest-restoration-scenarios/</li> <li>https://severalnines.com/blog/validating-your-postgresql-backups-docker/</li> </ul>"},{"location":"herramientas/postgresql/#pgbarman","title":"pgbarman","text":"<ul> <li>https://pgbarman.org/</li> <li>https://www.2ndquadrant.com/en/blog/pg-phriday-adventures-in-bar-management/</li> <li>https://severalnines.com/blog/using-barman-postgresql-disaster-recovery/</li> <li>https://severalnines.com/blog/using-barman-backup-postgresql-overview/</li> </ul>"},{"location":"herramientas/postgresql/#tabla-comparativa-de-herramientas-para-postgresql","title":"Tabla comparativa de herramientas para PostgreSQL","text":"Caracter\u00edstica pg_dump/pg_restore Barman pg_basebackup WAL-G pgBackRest Tipo de backup L\u00f3gico L\u00f3gico y f\u00edsico F\u00edsico F\u00edsico F\u00edsico Backups incrementales No S\u00ed S\u00ed (&gt;v17) S\u00ed S\u00ed PITR (Point-in-Time Recovery) No S\u00ed S\u00ed (con WAL) S\u00ed S\u00ed Compresi\u00f3n S\u00ed S\u00ed S\u00ed S\u00ed S\u00ed Cifrado No (manual) S\u00ed No (manual) S\u00ed S\u00ed Paralelizaci\u00f3n Limitada S\u00ed Limitada S\u00ed S\u00ed Verificaci\u00f3n autom\u00e1tica No S\u00ed No S\u00ed S\u00ed Almacenamiento en nube No (manual) Limitado No (manual) AWS/GCS/Azure AWS/GCS/Azure Deduplicaci\u00f3n No No No S\u00ed S\u00ed Interfaz web No No No No No Complejidad de configuraci\u00f3n Baja Media Baja Media Alta Madurez Alta Alta Alta Media Alta Mejor para Bases peque\u00f1as, esquemas espec\u00edficos Soluci\u00f3n completa Backups r\u00e1pidos Entornos cloud Alta disponibilidad"},{"location":"herramientas/proveedores_almacenamiento/","title":"Proveedores de almacenamiento","text":"<p>El uso de un proveedor cloud para el almacenamiento de la copia diferente a nuestro proveedor principal o a nuestra infraestructura on-premises puede aumentar la resiliencia del sistema.</p> <p>Un proveedor de almacenamiento externo permite mantener las copias en una infraestructura separada a la de producci\u00f3n, generalmente a precios asequibles, y en algunos casos ofreciendo funcionalidades extras, c\u00f3mo sistemas sencillos de monitorizaci\u00f3n y alertas.</p> <p>En una primera clasificaci\u00f3n podemos dividir los proveedores en tres grandes categor\u00edas.</p> <ul> <li>VPS especialmente pensados para backups o con almacenamiento barato</li> <li>Object Storage compatible con S3</li> <li>Almacenamiento especialmente enfocado a Backup</li> </ul> <p>A continuaci\u00f3n se presentan algunas opciones. En ning\u00fan caso se trata de una recomendaci\u00f3n, e iCarto no est\u00e1 afiliado con ninguno de ellos. Se trata s\u00f3lo de una visi\u00f3n de alto nivel de las opciones.</p> <p>Deben tenerse en cuenta caracter\u00edsticas particulares c\u00f3mo el hardware que emplean, APIs, ...</p>"},{"location":"herramientas/proveedores_almacenamiento/#vps","title":"VPS","text":"Proveedor RAM CPU Disco Transferencia Coste Notas HostHatch 1GB 1 CPU 1TB 2.5TB 5$ https://hosthatch.com/products#storage HostHatch 2GB 2 CPU 4TB 10TB 16$ https://hosthatch.com/products#storage AlphaVPS 2GB 2 CPU 1TB 3TB 4\u20ac Europeo. https://alphavps.com/storage-vps.html AlphaVPS 4GB 4 CPU 4TB 10TB 16\u20ac Europeo. https://alphavps.com/storage-vps.html"},{"location":"herramientas/proveedores_almacenamiento/#s3","title":"S3","text":"Proveedor Coste / TB Notas Scaleway 12\u20ac Europeo. https://www.scaleway.com/en/pricing/storage/ Upcloud 20\u20ac Europeo. https://upcloud.com/products/object-storage Intercolo 5\u20ac Europeo. https://intercolo.de/en/object-storage Hetzner 6\u20ac Europeo. https://www.hetzner.com/storage/object-storage/ Backblaze B2 6$ https://www.backblaze.com/cloud-storage/pricing"},{"location":"herramientas/proveedores_almacenamiento/#enfocados-a-backup","title":"Enfocados a backup","text":"<p>Productos especialmente enfocados a backup y archivo que no son S3</p> Proveedor Coste ~1 TB Enlace rsync.net 8$ https://www.rsync.net/pricing.html rsync.net 12$ BorgBase 6$ https://www.borgbase.com/ Hetzner 2\u20ac"},{"location":"herramientas/proveedores_almacenamiento/#rsyncnet","title":"rsync.net","text":"<ul> <li>snapshots de ZFS.</li> <li>Soporte para append-only de borg y restic</li> <li>Sin costes de transferencia</li> <li>Coste fijo por TB</li> </ul>"},{"location":"herramientas/proveedores_almacenamiento/#borgbase","title":"borgbase","text":"<ul> <li>Panel de control con alertas. APIs</li> <li>Soporte para append-only de borg y restic</li> <li>De Malta con servidores en EU y US</li> <li>Contribuyen al desarrollo de borg</li> <li>12.5$ por 2TB y repositorios ilimitados</li> </ul>"},{"location":"herramientas/proveedores_almacenamiento/#hetzner-storage-boxes","title":"Hetzner Storage Boxes","text":"<ul> <li>5TB por 11\u20ac. tr\u00e1fico ilimitado.</li> <li>100 subaccounts</li> <li>soporte para muchos protocolos</li> <li>Contribuyen al desarrollo de restic</li> <li>https://docs.hetzner.com/storage/storage-box/access/access-ssh-rsync-borg</li> <li>https://wiki.hetzner.de/index.php/BorgBackup/en</li> <li>https://www.hetzner.com/sb/#drives_size_from=0&amp;drives_size_to=11500&amp;ram_to=64&amp;price_to=290</li> </ul>"},{"location":"herramientas/proveedores_almacenamiento/#backblaze-b2","title":"Backblaze B2","text":"<ul> <li>Con restic y el object lock se pueden hacer desarrollar soluciones seguras sin necesidad de append-only</li> <li>https://www.backblaze.com/docs/en/cloud-storage-back-up-linux-to-backblaze-b2?highlight=restic</li> <li>https://www.backblaze.com/docs/en/cloud-storage-integrate-restic-with-backblaze-b2?highlight=restic</li> <li>https://www.backblaze.com/docs/cloud-storage-object-lock</li> </ul>"},{"location":"herramientas/ficheros/","title":"Herramientas para backup de ficheros","text":"<p>Hay much\u00edsimas buenas herramientas para copias de seguridad. Son dif\u00edciles de categorizar porqu\u00e9 muchas cumplen m\u00e1s de una funci\u00f3n o permiten m\u00e1s de un estilo, pero hacerlo ayuda a entender las opciones.</p> <p>Una posible clasificaci\u00f3n es:</p> <ul> <li>Backup del Proveedor Cloud. Los proveedores cloud proporcionan sus propios sistemas de backup.</li> <li>Snapshots y Mirrors. Incluimos en esta categor\u00eda sistemas de ficheros c\u00f3mo BTFRS, configuraciones hardware como ciertos RAID, y capacidades de los sistemas de virtualizaci\u00f3n. Son sistemas que en general funcionan on-site y necesitan complementarse con una herramienta de backups tradicional.</li> <li>Herramientas de clonado. Se basan en hacer una copia f\u00edsica del disco duro. Son \u00fatiles en servidores f\u00edsicos o para reproducir m\u00e1quinas exactas pero tienen menos sentido en un ambiente cloud o c\u00f3mo herramientas de backup.</li> <li>Suites de Backup. Son herramientas enormes, generalmente con una interfaz web que funcionan en modo cliente servidor (con agentes instalados en los nodos), plugins para casos espec\u00edficos (bases de datos), sistemas de monitorizaci\u00f3n, ...</li> <li>Estilo cp. Herramientas como <code>scp</code>, <code>rsync</code> o <code>rclone</code> pueden sacarnos de un apuro pero no deber\u00edan ser usadas, ya que hay opciones mejores m\u00e1s enfocadas a backup.</li> <li>Basadas en rsync. Herramientas de consola basadas en rsync, con funcionalidades de backup: <code>rsnaphost</code>, <code>rdiff-backup</code>, <code>duplicity</code></li> <li>Herramientas de deduplicaci\u00f3n y cifrado a nivel de bloque. Herramientas pensadas desde el principio para backups enfocadas al ahorro de espacio, y con modelos de amenazas fuertes: <code>borgbackup</code>, <code>restic</code>.</li> </ul> <p>Listados de herramientas:</p> <ul> <li>https://www.tecmint.com/linux-system-backup-tools/</li> <li>https://www.tecmint.com/linux-disk-cloning-tools/</li> <li>https://www.ubuntupit.com/free-open-source-backup-software-for-linux/</li> <li>https://askubuntu.com/questions/2596/comparison-of-backup-tools/</li> <li>https://opensource.com/article/19/3/backup-solutions</li> <li>https://wiki.archlinux.org/index.php/Synchronization_and_backup_programs</li> <li>https://askubuntu.com/questions/2596/comparison-of-backup-tools/</li> </ul>"},{"location":"herramientas/ficheros/basadas_en_rsync/","title":"Basadas en rsync","text":""},{"location":"herramientas/ficheros/basadas_en_rsync/#rsnaphost-y-rdiff-backup","title":"rsnaphost y rdiff-backup","text":"<p>Ambas son herramientas hist\u00f3ricas de backup ampliamente usadas.</p> <p>La mayor diferencia es que rsnaphost para cada copia, genera una carpeta con todos los ficheros. Cuando un fichero es igual entre copias simplemente usa un hardlink, cuando cambia almacena el fichero completo. El recuperar una versi\u00f3n antigua de un fichero no requiere de ning\u00fan programa en especial, se puede hacer con un simple cp, en este sentido la recuperaci\u00f3n de la copia de seguridad o de un fichero de una fecha concreta es transparente para el usuario.</p> <p>rdiff-backup almacena los ficheros completos de la \u00faltima copia. Pero para la retenci\u00f3n, funciona en modo reverse incremental almacena los reverse delta (cambios a nivel bloque entre los ficheros). Para recuperar un fichero de una copia antigua deben usarse las herramientas de rdiff-backup.</p> <p>rdiff-backup es m\u00e1s lento que rsnapshot y consume m\u00e1s CPU por la necesidad de calcular las delta. Adem\u00e1s almacena los metadatos (permisos, ...) de forma separada, y es m\u00e1s \"complejo\" por lo que el riesgo de error es mayor.</p> <p>Ambas se basan en el algoritmo de rsync para la transferencia. S\u00f3lo env\u00eda el cambio, no necesita enviar el fichero completo.</p> <p>Ambas realizan la transferencia mediante ssh (o samba, nfs, ...), con todo lo que ello implica:</p> <ul> <li>Permisos de escritura en la copia si es push, con lo que un atacante podr\u00eda arruinar la copia.</li> <li>En pull la copia debe tener acceso al servidor (firewalls, ...) Debe existir un usuario espec\u00edfico con permisos de s\u00f3lo lectura, teniendo en cuenta que ciertos ficheros pueden tener permisos de root/postgres/...</li> </ul> <p>La pol\u00edtica de retenci\u00f3n de <code>rdiff-backup</code> es muy limitada. S\u00f3lo permite eliminar las copias anteriores a una determinada fecha \"Borra lo que tenga m\u00e1s de dos semanas\". Pero para estrategias c\u00f3mo mant\u00e9n lo de hace un 1 a\u00f1o, y una versi\u00f3n por mes de los \u00faltimos 6 meses, habr\u00e1 sido necesario que el script de copia haya generado copias separadas. <code>rsnapshot</code> permite pol\u00edticas de retenci\u00f3n mucho m\u00e1s flexibles.</p> <p>Para ficheros grandes que cambian a menudo <code>rdiff-backup</code> ocupa mucho menos espacio.</p> <p>rdiff-backup en general ahorrar\u00e1 espacio sobre rsnapshot, sobre todo cuando tengas ficheros grandes que cambien a menudo (ficheros de bases de datos, ...). A nivel espacio:</p> <ul> <li>ficheros (sobre todo si son grandes) que var\u00edan mucho. rdiff-backup optimiza el espacio</li> <li>ficheros que var\u00edan poco. m\u00e1s o menos indiferente.</li> <li>cuando se creen muchos ficheros nuevos, m\u00e1s o menos indiferente.</li> <li>muchos archivos peque\u00f1os que cambian frecuentemente. rdiff-backup es lento.</li> </ul> <p>La conclusi\u00f3n podr\u00eda ser que si se necesita ahorrar espacio <code>rdiff-backup</code> es la mejor soluci\u00f3n. Si la retenci\u00f3n y recuperaci\u00f3n es una prioridad, mejor usar rsnapshot.</p> <p>Referencias:</p> <p>Comparativas:</p> <ul> <li>https://github.com/rdiff-backup/rdiff-backup</li> <li>https://github.com/rsnapshot/rsnapshot</li> <li>https://www.saltycrane.com/blog/2008/02/backup-on-linux-rsnapshot-vs-rdiff/</li> <li>https://www.linode.com/docs/guides/using-rdiff-backup-with-sshfs/</li> <li>https://www.tecmint.com/rsnapshot-a-file-system-backup-utility-for-linux/</li> </ul>"},{"location":"herramientas/ficheros/basadas_en_rsync/#duplicity","title":"Duplicity","text":"<ul> <li>https://duplicity.gitlab.io/</li> <li>https://www.cyberciti.biz/faq/duplicity-installation-configuration-on-debian-ubuntu-linux/</li> </ul> <p>Es muy parecido a rdiff-backup. La principal diferencia es que rdiff-backup crea un sistema de archivos en remoto, mientras que duplicity un \"tar comprimido y cifrado\".</p> <p>Ventajas:</p> <ul> <li>Soporta muchos \"protocolos de transferencia\": scp/ssh, ftp, rsync, WebDAV, S3</li> <li>Es capaz de firmar y cifrar los ficheros en el destino</li> </ul> <p>Desventajas:</p> <ul> <li>Usa incremental, y no reverse incremental, por tanto recuperar la copia actual implica usar las herramientas de duplicity, y tienen m\u00e1s riesgo de corrupci\u00f3n.</li> </ul> <p>Lo peor que tiene como herramienta corporativa es que no permite establecer con la propio herramienta una pol\u00edtica de retenci\u00f3n buena.</p> <p>No es un mal software. Muy parecido a rdiff-backup. En principio hay frontends escritos sobre \u00e9l y deber\u00eda haber muchos scripts potentes hechos, pero en la documentaci\u00f3n (que est\u00e1 bien, pero no super, tampoco listan ninguno bueno). Le falta un poco del \"enterprise\" que si tiene borg, como atenci\u00f3n contra hacking, motorizaci\u00f3n, ...</p>"},{"location":"herramientas/ficheros/clonado/","title":"Herramientas de clonado","text":"<p>Se basan en hacer una copia f\u00edsica del disco duro. Son \u00fatiles en servidores f\u00edsicos o para reproducir m\u00e1quinas exactas pero tienen menos sentido en un ambiente cloud o c\u00f3mo herramientas de backup.</p> <p>Muchas de ellas funcionan o est\u00e1n integradas en un disco de arranque que puede incluir funcionalidades diversas para recuperar un sistema c\u00f3mo reinstalar el boot.</p>"},{"location":"herramientas/ficheros/clonado/#dd","title":"dd","text":"<p>Es una herramienta de consola instalada por defecto. Permite crear im\u00e1genes de disco con facilidad. Muy potente pero hay que usarla con precauci\u00f3n porqu\u00e9 es f\u00e1cil cometer alg\u00fan error que arruine la copia o el sistema.</p> <p>Las im\u00e1genes que genera pueden montarse sin necesidad de restaurarlas realmente en un sistema.</p>"},{"location":"herramientas/ficheros/clonado/#clonezilla","title":"Clonezilla","text":"<ul> <li>https://clonezilla.org/</li> <li>https://www.tecmint.com/linux-centos-ubuntu-disk-cloning-backup-using-clonezilla/</li> <li>https://www.maketecheasier.com/clone-drives-and-partitions-with-clonezilla/</li> <li>https://www.howtoforge.com/tutorial/clone-encrypted-disk-image-with-clonezilla/</li> </ul> <p>Clonezilla es una de las mejores aplicaciones para clonar discos o particiones y hacer backups. Puede clonar directamente un disco a otro, o generar un fichero .img (raw image)</p> <p>Tiene dos variantes:</p> <ul> <li>Live. Un Live CD (o USB) con una aplicaci\u00f3n de consola e interfaz basada en ncurses</li> <li>Server. Que permite clonar hasta 40 equipos de forma simult\u00e1nea.</li> </ul>"},{"location":"herramientas/ficheros/clonado/#otras-herramientas","title":"Otras herramientas","text":"<ul> <li>PING. https://ping.windowsdream.com/</li> <li>G4L. https://sourceforge.net/projects/g4l/</li> <li>https://github.com/rear/rear</li> <li>Partclone. https://github.com/Thomas-Tsai/partclone</li> <li>FSArchiver. https://github.com/fdupoux/fsarchiver</li> </ul>"},{"location":"herramientas/ficheros/deduplicacion_y_cifrado/","title":"Herramientas de deduplicaci\u00f3n y cifrado a nivel de bloque","text":"<p>Estas herramientas operan a un nivel m\u00e1s bajo, fragmentando los archivos en bloques, deduplicando estos bloques para ahorrar espacio y cifr\u00e1ndolos.</p> <ul> <li>restic</li> <li>borgbackup</li> </ul> <p>Son opciones modernas, recomendadas para la mayor\u00eda de entornos.</p> <p>La elecci\u00f3n entre restic y borgbackup a menudo se reduce a preferencias personales, los backends de almacenamiento deseados (restic m\u00e1s flexible para la nube, borgbackup m\u00e1s centrado en SSH) y algunas caracter\u00edsticas espec\u00edficas (compresi\u00f3n de borgbackup, simplicidad de restic, consumo de RAM elevado de restic, ...).</p> <p>Ambas herramientas tienen bastantes similitudes.</p> <ul> <li>No trabajan con los ficheros en s\u00ed. Manejan el concepto de repositorio donde lo que se almacenan son \"bloques de bytes\" y no ficheros. Por tanto no se puede trabajar directamente con la copia si no que hay que hacerlo a trav\u00e9s de las herramientas.</li> <li>Son m\u00e1s complejas que las <code>rsync-based</code> y requieren m\u00e1s precauciones de verificaci\u00f3n de las copias, pruebas de restauraci\u00f3n, ... Pero ambos incluyen funcionalidades para verificar el repositorio y sistemas fuertes para evitar la corrupci\u00f3n</li> <li>Ambas tienen funcionalidades de deplicaci\u00f3n (si hay dos bloques iguales s\u00f3lo lo almacena una vez en disco ahorrando espacio) y cifrado (se cifra en origen por lo que se pueden almacenar los datos en sitios \"poco fiables\")</li> <li>Ambas pueden suponer un mayor consumo de CPU y RAM que las <code>rsync-based</code> en ciertas operaciones, bien del lado cliente, bien del lado servidor.</li> <li>Aunque ambos admiten compresi\u00f3n, la de borg parece mejor</li> <li>Ambos admiten cifrado, pero el de restic es mejor</li> <li>borg funciona \u00fanicamente a trav\u00e9s de SSH. restic, directamente o trav\u00e9s de rclone soporta m\u00e1s tipos de almacenamiento (SSH, HTTP Rest, S3, ...)</li> <li>Ambos funcionan en modo push y soportan el modo append-only aunque con diferencias. En borg debe configurarse a trav\u00e9s de SSH (authorized_keys, ...) en restic puede hacerse a trav\u00e9s de restic-server o ssh (con matices).</li> <li>Ambas son herramientas r\u00e1pidas y hay comparativas que tiran hacia un lado o hacia otro sin conclusiones claras. En principio restic es m\u00e1s r\u00e1pido que borg pero consume m\u00e1s espacio en disco y ancho de banda.</li> <li>En algunos casos restic llega a consumir mucha RAM, y puede llegar a bloquear el servidor.</li> <li>Una diferencia que puede ser importante es que el modelo de Borg es 1 servidor, 1 repositorio. Mediante que Restic permite almacenar varios servidores en el mismo repositorio (con deduplication entre varios servers por tanto). Pero debe valorarse adecuadamente si es buena idea tener varios servidores en el mismo repositorio. Uno de los problemas es que si un servidor tiene acceso al repositorio, tendr\u00e1 acceso a todo el repositorio, no s\u00f3lo a su \"parte\".</li> <li>Borg funciona en Linux/Mac. Restic tambi\u00e9n funciona en Windows.</li> <li>Ambos tienen un ecosistema amplio, GUIs, wrappers que a\u00f1aden funcionalidad, proveedores comerciales con soporte espec\u00edfico, herramientas web, integraci\u00f3n con sistemas de monitorizaci\u00f3n. El complemento por excelencia para restic es resticprofile y restic-server, y para borg es borgmatic.</li> </ul>"},{"location":"herramientas/ficheros/deduplicacion_y_cifrado/#referencias","title":"Referencias","text":"<ul> <li>https://dataswamp.org/~solene/2021-05-21-borg-vs-restic.html</li> <li>https://www.hostinger.com/blog/restic-borg</li> <li>https://nick.groenen.me/archive/2021/2021-10-10-comparison-between-restic-and-borg-backup/</li> <li>https://it-notes.dragas.net/2020/06/30/searching-for-a-perfect-backup-solution-borg-and-restic/</li> <li>https://stickleback.dk/borg-or-restic/</li> <li>https://www.reddit.com/r/BorgBackup/comments/v3bwfg/why_should_i_switch_from_restic_to_borg/</li> <li>https://www.somebits.com/weblog/tech/good/restic.html</li> </ul>"},{"location":"herramientas/ficheros/estilo_cp/","title":"Estilo cp","text":""},{"location":"herramientas/ficheros/estilo_cp/#rclone","title":"rclone","text":"<p>Dentro de estas herramientas merece la pena destacar <code>rclone</code>. rclone es un programa de l\u00ednea de comandos, estilo rsync, pero con m\u00e1s opciones para trabajar con \"cloud storage providers\" como S3, Google Drive y protocolos FTP, WebDav, ...</p> <ul> <li>https://github.com/rclone/rclone</li> <li>Tiene much\u00edsimas opciones, limitar el ancho de banda, cifrado, checksums, servir ficheros por http, ftp, ...</li> <li>Tiene un modo de control remoto, donde activa un servidor http que se puede controlar mediante API JSON REST</li> <li>Los ficheros en el storage provider se pueden usar de la forma normal que permita el storage.</li> <li>No hace env\u00edos parciales, \"sincroniza\" ficheros enteros que hayan cambiado.</li> </ul> <p>Es una herramienta interesante, y puede complementar a otras opciones de backup, pero no es una herramienta de backup en s\u00ed. No implementa nada de <code>retention policy</code>, ni monitorizaci\u00f3n, ...</p>"},{"location":"herramientas/ficheros/proveedor_cloud/","title":"Backup del Proveedor Cloud","text":"<p>La funcionalidad puede variar mucho de proveedor a proveedor.</p> <p>Por ejemplo en el servicio de backups de Linode:</p> <ul> <li>La copia se guarda en un hardware distinto pero en el mismo datacenter</li> <li>La retenci\u00f3n es fija. M\u00e1ximo 4 copias en cada momento. manual, 1 d\u00eda, 7 d\u00edas, 14 d\u00edas.</li> <li>Funciona a nivel ficheros, no snapshot/bloque. No vale para discos cifrados, y si cuadrara en medio de una transacci\u00f3n de la bd podr\u00eda quedar corrupta.</li> <li>2$ para los Linode de 1G (5$). 10$ para los Linode de 8G (48$)</li> </ul> <p>Son una buena opci\u00f3n c\u00f3mo primera l\u00ednea de defensa para una estrategia de backups 3-2-1, pero no c\u00f3mo una soluci\u00f3n completa por los problemas de:</p> <ul> <li>Mismo datacenter</li> <li>Retenci\u00f3n</li> <li>Corrupci\u00f3n de la base de datos</li> </ul>"},{"location":"herramientas/ficheros/suites/","title":"Suites de Backup","text":"<p>Son herramientas enormes, generalmente con una interfaz web que funcionan en modo cliente servidor (con agentes instalados en los nodos), plugins para casos espec\u00edficos (bases de datos), sistemas de monitorizaci\u00f3n, ...</p> <p>Una de las herramientas m\u00e1s interesantes en este \u00e1mbito es Bareos.</p>"},{"location":"herramientas/ficheros/suites/#bareos","title":"Bareos","text":"<ul> <li>https://github.com/bareos/bareos</li> </ul> <p>Bareos es una suite de backup con licencia AGPL (no open-core, ni similar), desarrollado por una empresa que ofrece servicios y soporte sobre el software.</p> <p>Funciona en base a tres componentes:</p> <ul> <li><code>Director</code>. El servidor. Se encarga de orquestar todo</li> <li><code>File Daemons</code>. El cliente. Se instala en el ordenador a copiar. Cifra todo en local antes de enviarlo. y lo envia al Storage Daemon. Admite plugins (ie: postgresql)</li> <li><code>Storage Daemon</code>. Que puede estar instalado en el mismo sitio que el Director. Se encarga de almacenar la info en local, S3, ...</li> <li><code>Catalog</code>. Base de datos. Un PostgreSQL donde se guarda toda la info y metadata de configuraci\u00f3n, clientes, backups, ...</li> </ul> <p>Naci\u00f3 en 2010 como un fork de Bacula. Pero tiene mejor documentaci\u00f3n y es m\u00e1s clara la relaci\u00f3n entre el producto comercial y el libre que con Bacula o Amada</p> <p>Tiene plugin para PostgreSQL, y las opciones habituales de estas aplicaciones, deduplication, full/incremental/diferential, ...</p>"},{"location":"herramientas/ficheros/suites/#urbackup","title":"UrBackup","text":"<ul> <li>https://www.urbackup.org/</li> </ul> <p>Caracter\u00edsticas:</p> <ul> <li>Cliente - Servidor</li> <li>Usa SQLite como base de datos.</li> <li>Copia ficheros (l\u00f3gico) o hace im\u00e1genes (f\u00edsico).</li> <li>Interfaz web, ...</li> <li>full e incremental. (tanto en l\u00f3gico como en f\u00edsico)</li> <li>Clientes y server multiplataforma</li> <li>Admite backup de PostgreSQL mediante wal y dumps. https://www.urbackup.org/backup_postgresql.html</li> <li>Deduplication. Aunque sugieren usar btrfs</li> <li>Pensado para almacenar las copias en local del servidor, no S3 o similar.</li> <li>585 stars</li> </ul> <p>UrgBackup puede ser una alternativa interesante a Bareos aunque tiene menos tracci\u00f3n</p>"},{"location":"herramientas/ficheros/suites/#minarca","title":"Minarca","text":"<ul> <li>https://minarca.org/en_CA</li> </ul> <p>Es c\u00f3mo poner una interfaz web sobre rdiff-backup, donde ver estad\u00edsticas, lanzar alertas, ... En el cliente (windows, linux y mac) se instala un paquete tambi\u00e9n.</p> <p>Las ventajas y problemas de rdiff-backup van tambi\u00e9n con Minarca.</p> <p>M\u00e1s \u00fatil como backup para equipos personales que para servidores.</p>"},{"location":"herramientas/ficheros/suites/#otras-herramientas-de-este-tipo","title":"Otras herramientas de este tipo","text":"<ul> <li>Bacula. Muy potente pero pero tambi\u00e9n muy compleja de configurar<ul> <li>https://www.spiceworks.com/tech/it-strategy/articles/amanda-vs-bacula-backup-software/</li> <li>https://www.digitalocean.com/community/tutorials/how-to-back-up-an-ubuntu-14-04-server-with-bacula</li> </ul> </li> <li>Burp. Parece sencillo y potente, pero s\u00f3lo tiene 0.5k stars en github. No se puede usar un sw de backup con poca tracci\u00f3n. Adem\u00e1s no tiene binarios hay que compilarlo.</li> <li>Amanda. Amanda es la versi\u00f3n libre de Zmanda. Ambos productos son desarrollados por la misma empresa en una especie de modelo open-core. Aunque las releases de Amanda parecen bastante por detr\u00e1s de las de zmanda, y la relaci\u00f3n entre ambas herramientas es compleja.<ul> <li>https://www.amanda.org/</li> <li>https://www.zmanda.com/amanda-community/</li> <li>https://github.com/zmanda/amanda/</li> <li>https://wiki.zmanda.com/index.php</li> </ul> </li> </ul>"},{"location":"implementacion/","title":"Implementaci\u00f3n","text":"<p>En esta secci\u00f3n se describe la implementaci\u00f3n pr\u00e1ctica de la estrategia gen\u00e9rica de copias de seguridad de iCarto.</p> <p>Esta estrategia se emplea para la mayor\u00eda de servidores internos y de clientes, aunque existen casos espec\u00edficos para los que se usan otras estrategias.</p>"},{"location":"implementacion/#contexto","title":"Contexto","text":"<p>iCarto es una empresa de consultor\u00eda tecnol\u00f3gica peque\u00f1a.</p> <ul> <li>Realiza consultor\u00eda tecnol\u00f3gica y fortalecimiento institucional</li> <li>Crea, Analiza, Mantiene y Disponibiliza \"datos\" para \u00e1mbitos diversos</li> <li>Desarrolla aplicaciones a medida y Sistemas de Informaci\u00f3n</li> <li>Proporciona soporte t\u00e9cnico especializado en \u00e1reas c\u00f3mo los Sistemas de Informaci\u00f3n Geogr\u00e1fica</li> <li>Mantiene los sistemas en producci\u00f3n</li> </ul> <p>Esta actividad se desarrolla para clientes p\u00fablicos y privados de distintas partes del mundo, especialmente en contextos de bajas capacidades tecnol\u00f3gicos, o sin capacidad para administrar los sistemas.</p> <p>El equipo mantiene m\u00e1s de 15 servidores de producci\u00f3n. Estos servidores pueden estar en on-premises propio o del cliente, y proveedores cloud propios (Linode) o del cliente. Cada infraestructura tiene sus particularidades (VPN, ...)</p> <p>Las bases de datos van desde unas decenas de megas, hasta los ~100GB. Los ficheros adjuntos y otros assets est\u00e1ticos se mueven en los mismos rangos.</p> <p>La mayor\u00eda de nuestros sistemas se pueden considerar corporativos, se usan \u00fanicamente en horario de oficina seg\u00fan la zona horaria en que se encuentren.</p>"},{"location":"implementacion/#necesidades-y-discusion-de-la-solucion","title":"Necesidades y discusi\u00f3n de la soluci\u00f3n","text":""},{"location":"implementacion/#soberania-tecnologica","title":"Soberan\u00eda tecnol\u00f3gica","text":"<p>iCarto apuesta por la soberan\u00eda tecnol\u00f3gica de las organizaciones con las que trabaja. Queremos que nuestros clientes puedan apropiarse de la infraestructura en el futuro. Eso implica reducir las dependencias de proveedores comerciales, software complejo, centralizaci\u00f3n, ...</p> <p>Las suites de backup (Bareos, ...) o proveedores cloud comerciales de backups, aportan en una soluci\u00f3n integral la mayor\u00eda de necesidades de backups (configuraci\u00f3n, monitorizaci\u00f3n, pol\u00edticas de retenci\u00f3n complejas, ...). Permiten ver el estado general de los backups, si algo fall\u00f3, el volumen ocupado, ir a la versi\u00f3n (o fichero) concreto que se quiere restaurar. A cambio suponen una enorme centralizaci\u00f3n y/o un grado alto de expertise.</p> <p>Las descartamos porqu\u00e9 es dif\u00edcil que el cliente pueda hacerse cargo en alg\u00fan momento de esa infraestructura.</p> <p>Optaremos en general por soluciones que permitan la descentralizaci\u00f3n y sean de software libre (preferiblemente con soporte comercial)</p>"},{"location":"implementacion/#postgresql","title":"PostgreSQL","text":"<p>Las tecnolog\u00edas para hacer copias de seguridad de PostgreSQL son variadas y pueden llegar a ser muy complejas. Pero en muchas aplicaciones c\u00f3mo las empresariales usadas en horario laboral se pueden definir estrategias y tecnolog\u00edas sencillas que cumplan con necesidades exigentes.</p> <p>Nuestra propuesta de backup para PostgreSQL se basa en que:</p> <ul> <li>Consideramos la replicaci\u00f3n de bases de datos un mecanismo de Alta Disponibilidad (HA) y no de backups. Los sistemas de HA empleados c\u00f3mo sistema de backups tienen inconvenientes respecto a otras estrategias que no merece la pena considerar. La estrategia que planteamos funciona no obstante incluso en entornos active-active qu\u00e9 admitan perdidas de conexi\u00f3n temporales (ie: con bucardo)</li> <li>La mayor\u00eda de herramientas de backup para PostgreSQL parten de la premisa de evitar los downtime. Cuando apagar la base de datos es factible en ciertas ventanas (de madrugada) los problemas se simplifican.</li> <li>PITR, recuperar el estado en un punto concreto reconstruyendo las transaciones a partir de un backup, no es necesario. Llega con la granularidad que aportan los backups (por ejemplo diaria)</li> </ul> <p>Estas premisas, casi, nos permiten ignorar la existencia de una base de datos, y entenderla \u00fanicamente c\u00f3mo ficheros en el disco duro. Es good enough emplear la misma herramienta que se use para el resto de ficheros.</p> <p>Aunque debe tenerse en cuenta que:</p> <ul> <li>Copiar ficheros directamente (al igual que <code>pg_basebackup</code> y similares) est\u00e1 muy acoplado a la versi\u00f3n, extensiones, versiones de las librer\u00edas de collation, ... del cluster concreto de PostgreSQL que se est\u00e9 copiando.</li> <li>Es necesario mantener un registro de que versi\u00f3n va con que backup, y resto de \"metadatos\" que permitan reproducir el entorno</li> <li>Las pruebas de restauraci\u00f3n y verificaci\u00f3n son m\u00e1s cr\u00edticas (y complicadas) de lo habitual</li> <li>La estructura de la base de datos (tablas muy grandes, muchas tablas, cantidad de cambios, ...) afectar\u00e1 mucho al espacio de almacenamiento y ancho de banda seg\u00fan el tipo de backup (full, incremental, ...) y a c\u00f3mo funcione la herramienta:<ul> <li>Por ejemplo <code>rdiff-backup</code> trabaja mediante deltas, s\u00f3lo env\u00eda los cambios en el fichero. Es bueno para ficheros/tablas grandes con cambios regulares pero har\u00e1 m\u00e1s lenta encontrar un cambio concreto y la recuperaci\u00f3n. <code>rsnaphost</code> trabaja con enlaces y ficheros enteros. Un cambio m\u00ednimo en una tabla grande significa la retransmisi\u00f3n completa del fichero.</li> </ul> </li> </ul> <p>As\u00ed que en nuestro caso la tarea programada de backups apaga la base de datos y resto de servicios, provocando el flush a disco de la informaci\u00f3n. Se lleva a cabo la creaci\u00f3n del backup mediante borgmatic que es bastante eficiente en la detecci\u00f3n y almacenamiento de \u00fanicamente los cambios.</p>"},{"location":"implementacion/#contenedores","title":"Contenedores","text":"<p>Los contenedores son gestionados de forma similar a PostgreSQL. La configuraci\u00f3n, ... se gestiona mediante las herramientas de provisionamiento / IaC / ... Los paramos antes de realizar el backup y se hace una copia de los vol\u00famenes de inter\u00e9s.</p>"},{"location":"implementacion/#modelo-de-amenaza","title":"Modelo de Amenaza","text":"<p>Manejamos servidores que no pueden ser accedidos desde el exterior de la red. Esto hace que los modelos pull no sean una buena opci\u00f3n.</p> <p>El uso de servidores intermedios en un modelo push + pull aumenta la complejidad y los costes de forma exponencial.</p> <p>El problema de los modelos push es que un incidente en cascada (generalmente un ataque intencionado estilo randomware a producci\u00f3n) puede destruir las copias. Por ello optamos por un modelo push + append-only. El servidor de producci\u00f3n puede a\u00f1adir datos, pero no modificar los datos ya almacenados, lo que protege de ese tipo de ataques. Este modelo permite adem\u00e1s que un hackeo del backup no de acceso a producci\u00f3n.</p> <p>Se asume que el servidor de backups podr\u00eda verse comprometido por ello los datos se cifran en origen.</p> <p>El punto m\u00e1s cr\u00edtico en este modelo es el nodo desde el que se pueden automatizar las tareas de los servidores de producci\u00f3n. Para reducir el riesgo este nodo no tiene acceso al sistema de almacenamiento. Todas las tareas sobre el servidor de almacenamiento se realizan de forma manual con las credenciales de acceso aisladas de otros sistemas.</p>"},{"location":"implementacion/#otras-consideraciones","title":"Otras consideraciones","text":"<ul> <li>Es muy poco habitual que nos soliciten recuperar un fichero antiguo concreto. Por lo que t\u00e9cnicas c\u00f3mo reverse incremental o herramientas c\u00f3mo rdiff-backup no ser\u00edan un problema. Con herramientas c\u00f3mo borg o restic recuperar ficheros individuales no es problem\u00e1tico.</li> <li>En las herramientas que funcionan sobre ssh (sin append-only) debe usarse pull.<ul> <li>La copia debe ver la red (vpn, firewall, ...).</li> <li>Debe crearse un usuario de s\u00f3lo lectura sobre los datos a copiar. Si no un atacante que se haga con el backup podr\u00eda destruir el origen</li> <li>Debe tenerse en cuenta que algunos datos pueden pertenecer a usuarios/grupos c\u00f3mo tomcat/apache/postgres/... por lo que la configuraci\u00f3n de permisos puede ser compleja</li> </ul> </li> <li>Retenci\u00f3n flexible. El sistema debe proporcionar una pol\u00edtica de retenci\u00f3n flexible adaptada a cada sistema.</li> </ul>"},{"location":"implementacion/arquitectura/","title":"Arquitectura General del Sistema de Backups","text":"<p>Descripci\u00f3n de alto nivel de la arquitectura de backups que empleamos.</p>"},{"location":"implementacion/arquitectura/#principio-3-2-1","title":"Principio 3-2-1","text":"<p>Cuando es posible se sigue el principio 3-2-1 (tres copias en dos medios distintos con una copia offsite).</p> <ul> <li>Almacenamiento primario: Se usa c\u00f3mo primera l\u00ednea el servicio del proveedor que se est\u00e9 empleando, c\u00f3mo el servicio de backups de Linode.</li> <li>Almacenamiento secundario: La arquitectura que se describe a continuaci\u00f3n mediante Borgmatic.</li> <li>Almacenamiento off-site: Anualmente cuando se hace la prueba de restauraci\u00f3n se hace una copia de los repositorios a un disco duro externo (con los repositorios cifrados)</li> </ul>"},{"location":"implementacion/arquitectura/#provisionamiento","title":"Provisionamiento","text":"<p>La configuraci\u00f3n de los backups es parte est\u00e1ndar del provisionamiento de nuevos servidores.</p> <p>El provisionamiento se realiza mediante playbooks de Ansible, scripts en bash y algunos pasos manuales (c\u00f3mo subir la clave ssh y crear el repositorio)</p> <p>El mecanismo que empleamos permite gestionar de forma sencilla configuraciones distintas para cada servidor, cifrar las passphrase, ...</p>"},{"location":"implementacion/arquitectura/#clientes","title":"Clientes","text":"<p>Usamos Borg (Borgmatic) para llevar a cabo las copias de seguridad.</p> <p>En cada cliente (servidor de producci\u00f3n) queda instalado Borgmatic tras el provisionamiento.</p> <p>La tarea se ejecuta bajo el usuario root, para el que se ha creado una clave SSH espec\u00edfica para Borgmatic (<code>/root/.ssh/borgmatic</code>)</p> <p>Borg cifra y firma los datos antes de que abandonen el servidor de modo que no es necesario confiar en terceros.</p>"},{"location":"implementacion/arquitectura/#periodicidad-y-retencion","title":"Periodicidad y Retenci\u00f3n","text":"<p>Una tarea de cron ejecuta la copia con la periodicidad deseada. Habitualmente de lunes a viernes en horario de madrugada seg\u00fan la zona horaria.</p> <p>Cuando se configura el provisionamiento se intenta que los backups en los servidores sean escalonados para evitar presionar al alojamiento, sobre todo durante los <code>checks</code>.</p> <p>La pol\u00edtica de retenci\u00f3n se controla directamente a trav\u00e9s de la configuraci\u00f3n de Borgmatic y la operaci\u00f3n de compactaci\u00f3n en el almacenamiento.</p> <p>Habitualmente, mantenemos copia de los cuatro \u00faltimos d\u00edas, las tres \u00faltimas semanas, los tres \u00faltimos meses y los tres \u00faltimos a\u00f1os.</p> <pre><code>borg_keep_daily: 4\nborg_keep_weekly: 3\nborg_keep_monthly: 3\nborg_keep_yearly: 3\n</code></pre>"},{"location":"implementacion/arquitectura/#verificacion","title":"Verificaci\u00f3n","text":"<p>La verificaci\u00f3n de los backups se lleva a cabo mediante la herramienta de check, la periodicidad y profundidad se configura para cada caso. Habitualmente:</p> <pre><code># https://torsion.org/borgmatic/docs/how-to/deal-with-very-large-backups/\nborgmatic_checks:\n    - name: repository\n      frequency: \"4 weeks\"\n    - name: archives\n      frequency: \"6 weeks\"\n    - name: spot\n      frequency: \"always\"\n      count_tolerance_percentage: 10\n      data_sample_percentage: 1\n      data_tolerance_percentage: 0.5\n    - name: data\n      frequency: \"6 months\"\n#   Handled as a manual restoration test\n#   - name: extract\n#     frequency: \"always\"\n\nborgmatic_check_last: 3\n</code></pre>"},{"location":"implementacion/arquitectura/#alojamiento-de-las-copias","title":"Alojamiento de las copias","text":"<p>Usamos BorgBase para almacenar las copias de seguridad.</p> <p>La mayor\u00eda de servidores est\u00e9n bajo una \u00fanica cuenta, con un repositorio distinto para cada servidor.</p> <p>A cada repositorio se a\u00f1aden dos claves p\u00fablicas SSH, la del servidor y una de mantenimiento. S\u00f3lo se a\u00f1aden con permisos append-only. Un atacante que obtenga acceso al servidor en producci\u00f3n no puede modificar los backups.</p> <p>Todas las operaciones de edici\u00f3n en BorgBase (compactar repositorios, a\u00f1adir claves o repositorios, ...) se realizan \u00fanicamente a trav\u00e9s de la interfaz web. Esto disminuye la operatividad pero tambi\u00e9n los vectores de ataque.</p> <p>Los datos de acceso a la cuenta de BorgBase est\u00e1n aislados del resto de credenciales y s\u00f3lo el personal m\u00ednimo imprescindible tiene acceso a ellos.</p> <p>La dependencia del proveedor es reducida. Se puede emplear otro servicio (rsync.net, Hetzner), un VPS, o <code>on-premises</code> (NAS, ...). Lleva con exportar el repositorio y cambiar el fichero de configuraci\u00f3n de Borgmatic.</p>"},{"location":"implementacion/arquitectura/#monitorizacion-y-alertas","title":"Monitorizaci\u00f3n y Alertas","text":"<p>Empleamos la integraci\u00f3n de Borgmatic con el servicio healthcheck.io para las alertas.</p> <p>Cuando una copia no se realiza con la periodicidad establecida o existe un error en cualquier punto del proceso (arrancar los servicios, verificaci\u00f3n, ...) una alerta por correo-e llega al equipo.</p> <p>En healthcheck almacenamos un log de cada tarea con la informaci\u00f3n m\u00e1s relevante.</p> <p>Cada servidor est\u00e1 configurado con su propia alerta en una cuenta com\u00fan.</p> <p>La dependencia del proveedor es reducida. Se trata de una aplicaci\u00f3n de software libre con una capa gratuita, que puede ser substituido sin esfuerzo por servicios similares.</p> <p>Las m\u00e9tricas se obtienen actualmente de forma manual. Con la clave ssh de mantenimiento y la configuraci\u00f3n del servidor usada para el provisionamiento se usa una instancia local de Borgmatic para obtener informaci\u00f3n en JSON de los repositorios remotos y generar unas estad\u00edsticas b\u00e1sicas.</p>"},{"location":"implementacion/arquitectura/#pruebas-de-restauracion","title":"Pruebas de restauraci\u00f3n","text":"<p>Por defecto llevamos a cabo pruebas de restauraci\u00f3n completas una vez al a\u00f1o. Estas pruebas de restauraci\u00f3n se hacen por ahora de forma manual.</p> <p>Para cada servidor se hacen tests funcionales sobre el \u00faltimo archivo de copia. Para un subconjunto de los servidores se hacen las pruebas de restauraci\u00f3n para otros archivos (adem\u00e1s del \u00faltimo) para comprobar la integridad y pol\u00edticas de retenci\u00f3n.</p> <p>Las pruebas se llevan a cabo sobre m\u00e1quinas vagrant que se provisionan de la misma forma que los servidores de producci\u00f3n (salvo particularidades).</p>"},{"location":"implementacion/implementacion/","title":"Implementaci\u00f3n","text":"<p>Todav\u00eda no hemos publicado los playbooks y otros assets de inter\u00e9s.</p> <p>Si tienes inter\u00e9s abre una issue.</p>"},{"location":"marco_teorico/","title":"Marco Te\u00f3rico","text":"<p>La estrategia o pol\u00edtica de backups depende de factores c\u00f3mo:</p> <ul> <li>Riesgos y amenazas</li> <li>Criticidad de los datos</li> <li>RPO, RTO, necesidades de Retenci\u00f3n y PITR</li> <li>Coste y complejidad de la soluci\u00f3n</li> <li>Seguridad de la copia (cifrado, ...)</li> <li>Monitorizaci\u00f3n y Alertas</li> <li>...</li> </ul> <p>Para definir la estrategia correcta es necesario entender una serie de conceptos que se detallan en las siguientes secciones.</p>"},{"location":"marco_teorico/completa_incremental_diferencial/","title":"Completo / Incremental / Diferencial","text":"<p>Los backups se pueden categorizar de muchas formas entre ellas si son completos o incrementales.</p>"},{"location":"marco_teorico/completa_incremental_diferencial/#completo-full","title":"Completo (Full)","text":"<p>Copia total de los datos seleccionados</p> <ul> <li>Ventajas: Recuperaci\u00f3n simple y r\u00e1pida</li> <li>Desventajas: Mayor espacio de almacenamiento y tiempo de ejecuci\u00f3n</li> <li>Ideal para:<ul> <li>Servidores peque\u00f1os con datos cr\u00edticos</li> <li>Entornos donde el espacio de almacenamiento o el ancho de banda no es una limitaci\u00f3n</li> <li>Servidores de configuraci\u00f3n</li> <li>Sistemas que requieren restauraci\u00f3n r\u00e1pida</li> <li>Cuando existe la necesidad frecuente de recuperar ficheros espec\u00edficos en momentos concretos</li> <li>Cuando se quiere reducir al m\u00e1ximo la complejidad del sistema, a cambio de aumentar el coste</li> </ul> </li> </ul>"},{"location":"marco_teorico/completa_incremental_diferencial/#incremental-incremental","title":"Incremental (Incremental)","text":"<p>Copia solo los cambios desde el \u00faltimo backup (completo o incremental)</p> <ul> <li>Ventajas: R\u00e1pido, menor espacio</li> <li>Desventajas: Restauraci\u00f3n m\u00e1s compleja, dependencia de la cadena de backups</li> <li>Ideal para:<ul> <li>Grandes vol\u00famenes de datos con cambios frecuentes</li> <li>Se quiere mantener al m\u00ednimo el espacio en disco y el consumo de red</li> <li>Entornos con ventanas de backup reducidas</li> <li>Permiten incrementar granularidad (RPO) sin incrementar costes</li> </ul> </li> </ul>"},{"location":"marco_teorico/completa_incremental_diferencial/#diferencial-differential","title":"Diferencial (Differential)","text":"<p>Copia los cambios desde el \u00faltimo backup completo</p> <ul> <li>Ventajas: Restauraci\u00f3n m\u00e1s sencilla que incremental</li> <li>Desventajas: Ocupa m\u00e1s espacio que incremental</li> <li>Ideal para:<ul> <li>Situaciones intermedias que requieren equilibrio entre espacio y tiempo de restauraci\u00f3n</li> <li>Sistemas donde es aceptable un tiempo de recuperaci\u00f3n moderado pero se quiere reducir el riesgo de backups corruptos</li> </ul> </li> </ul>"},{"location":"marco_teorico/completa_incremental_diferencial/#comparativa-de-tipos-basicos-de-backup","title":"Comparativa de tipos b\u00e1sicos de backup","text":"Caracter\u00edstica Completo Incremental Diferencial Velocidad de backup Lenta Muy r\u00e1pida R\u00e1pida (se ralentiza con el tiempo) Velocidad de restore Muy r\u00e1pida Lenta (requiere full + todas las incrementales) Media (requiere full + \u00faltima diferencial) Ancho de banda Alto Muy bajo Medio (aumenta con el tiempo) Espacio en disco Muy alto M\u00ednimo Medio (crece con el tiempo) Riesgo de restore incorrecto Bajo Alto (fallo en cualquier incremental afecta todo) Medio (solo dos puntos de fallo) Escenario ideal Datos cr\u00edticos con pocos cambios Entornos con ancho de banda limitado Balance entre espacio y confiabilidad Coste de implementaci\u00f3n Simple Complejo Moderado"},{"location":"marco_teorico/completa_incremental_diferencial/#mirror-backup","title":"Mirror backup","text":"<p>La definici\u00f3n de \"mirror backup\" var\u00eda seg\u00fan la fuente. Lo m\u00e1s habitual es entenderla c\u00f3mo</p> <p>una copia exacta del conjunto de datos original, pero solo se almacena la versi\u00f3n m\u00e1s reciente, sin conservar versiones anteriores. Se llama \"espejo\" porque refleja exactamente el estado actual de los datos originales. Todos los archivos se almacenan de forma individual, igual que en el sistema de origen.</p> <ul> <li>Recuperaci\u00f3n r\u00e1pida: puedes restaurar archivos sin complicaciones.</li> <li>Acceso directo a los archivos respaldados individualmente.</li> <li>Ocupa mucho espacio.</li> <li>Si los datos originales se da\u00f1an o se eliminan, el da\u00f1o tambi\u00e9n afecta al backup.</li> </ul> <p>Un tipo espec\u00edfico de copia espejo son ciertos modos de RAID. Los datos se replican en dos (o m\u00e1s) discos en el propio servidor. En caso de que un disco falle el otro seguir\u00e1 funcionando y la monitorizaci\u00f3n nos avisar\u00e1 de la necesidad de cambiarlo.</p> <p>Merece la pena mencionar este sistema, pero entrar\u00eda m\u00e1s en el \u00e1mbito de la alta disponibilidad que en el de las copias de seguridad.</p>"},{"location":"marco_teorico/completa_incremental_diferencial/#variantes-avanzadas","title":"Variantes avanzadas","text":"<p>Existen variantes m\u00e1s sofisticadas de estas estrategias b\u00e1sicas:</p> <ul> <li> <p>Synthetic Full Backup: Crea un nuevo backup completo (en el destino) combinando el \u00faltimo full con los incrementales, sin necesidad de transferir todos los datos desde la fuente. Ahorra ancho de banda pero no espacio de almacenamiento. Puede mejorar el tiempo de restauraci\u00f3n.</p> </li> <li> <p>Progressive Incremental (Incremental-Forever): Solo se realiza un backup completo inicial, seguido de incrementales indefinidamente.</p> </li> <li> <p>Reverse Incremental: Cada incremental se aplica inmediatamente al backup completo, creando un nuevo completo actualizado, mientras conserva los incrementales para poder retroceder a estados anteriores. Requiere de herramientas m\u00e1s complejas pero disminuye el problema del tiempo de restauraci\u00f3n de los sistemas incrementales.</p> </li> <li> <p>Forever Forward Incremental: Similar al incremental-forever, pero mantiene solo una generaci\u00f3n de backup en el servidor, renovando peri\u00f3dicamente el backup completo mediante la fusi\u00f3n de incrementales.</p> </li> </ul>"},{"location":"marco_teorico/logicas_vs_fisicas/","title":"Copias l\u00f3gicas vs f\u00edsicas","text":"<p>Otra caracter\u00edstica de las copias de seguridad es si est\u00e1s se hacen a nivel l\u00f3gico o a nivel f\u00edsico.</p>"},{"location":"marco_teorico/logicas_vs_fisicas/#en-base-de-datos","title":"En base de datos","text":"<p>En las bases de datos la informaci\u00f3n se persiste a ficheros en el disco duro, aproximadamente un fichero por tabla. Pero los datos no se consolidan en estos ficheros de forma inmediata tras una operaci\u00f3n. Para asegurar la integridad y el rendimiento se usan t\u00e9cnicas que implican el uso de la RAM y \"ficheros intermedios\".</p> <p>Esto es relevante para entender porqu\u00e9 hay que tener muchas precauciones para hacer una copia de la base de datos simplemente copiando los ficheros en disco. Y de ah\u00ed se deriva la importancia de entender la diferencia entre copias l\u00f3gicas y f\u00edsicas.</p> <ul> <li>Beneficios de las copias l\u00f3gicas vs f\u00edsicos</li> </ul>"},{"location":"marco_teorico/logicas_vs_fisicas/#logica","title":"L\u00f3gica","text":"<p>En el nivel l\u00f3gico la copia en s\u00ed es una representaci\u00f3n ya consolidada de los datos. Generalmente usando el formato SQL, o formatos binarios propios. Realizadas habitualmente con <code>pg_dump</code>.</p> <p>Ofrecen:</p> <ul> <li>Flexibilidad: Permiten realizar copias de seguridad y restaurar tablas o subconjuntos de datos espec\u00edficos, lo cual es ideal para bases de datos grandes, ahorrando tiempo y recursos.</li> <li>Portabilidad: Se pueden transferir f\u00e1cilmente entre diferentes instancias de PostgreSQL o incluso entre distintos sistemas de gesti\u00f3n de bases de datos, siendo \u00fatiles para la migraci\u00f3n de datos.</li> <li>Transparencia: Son legibles por humanos, lo que facilita la inspecci\u00f3n, modificaci\u00f3n y resoluci\u00f3n de problemas.</li> <li>Espacio: Un full backup en formato l\u00f3gico ocupar\u00e1 en general menos que en formato f\u00edsico</li> </ul> <p>Desventajas:</p> <ul> <li>No tienen modo incremental. Siempre es full backup</li> <li>Se necesita combinar herramientas. Hay objetos de la bd como los usuarios que no se exportan con pg_dump y es necesario usar pg_dumpall.</li> <li>Se deber\u00eda hacer un ANALYZE tras el restore haci\u00e9ndolo a\u00fan m\u00e1s lento.</li> </ul>"},{"location":"marco_teorico/logicas_vs_fisicas/#fisico","title":"F\u00edsico","text":"<p>En el nivel f\u00edsico se trabaja es con los ficheros en disco, usando herramientas como <code>pg_basebackup</code>, y que con muchos matices podr\u00edamos asimilar a hacer un copy&amp;paste de los ficheros.</p> <p>Ofrecen:</p> <ul> <li>Mayor velocidad: Son m\u00e1s r\u00e1pidas que las copias l\u00f3gicas.</li> <li>Flexibilidad en la estrategia: Ofrecen una gran flexibilidad para que los administradores de bases de datos personalicen su enfoque de respaldo, incluyendo copias de seguridad completas, incrementales y diferenciales.</li> <li>Ideales para grandes bases de datos: Cuando deben gestionarse downtimes, retenci\u00f3n de datos, ...</li> <li>Admiten modo incremental, PITR, ...</li> <li>Permiten llegar a un RPO de 0. Es decir hacer un backup continuo de modo que nunca haya perdida de datos o por ejemplo pueda recuperar una versi\u00f3n de una hora y d\u00eda concreto. Es un problema de rendimiento y espacio. Cuantas \"m\u00e1s versiones\" m\u00e1s estresaremos la bd con los backups (menos rendimiento para otras cosas) y m\u00e1s espacio en disco ocupado.</li> <li>Recuperar una tabla concreta generalmente implica restaurar en un servidor adicional el cluster entero, exportar la tabla e importarla en el servidor de producci\u00f3n.</li> </ul> <p>Desventajas:</p> <ul> <li>M\u00e1s complejidad</li> <li>Dependen de la versi\u00f3n de la bse de datos y de las extensiones instaladas</li> <li>No son selectivas sobre que conjunto de datos copiar. Se exporta todo el cluster generalmente.</li> </ul>"},{"location":"marco_teorico/logicas_vs_fisicas/#en-disco","title":"En disco","text":"<p>Para los ficheros en disco se puede hacer una diferenciaci\u00f3n similar.</p> <p>El nivel f\u00edsico en disco son \"bloques de bytes\", 1 y 0, que son transformados por el sistema operativo y el sistema de ficheros, en archivos con datos. Cuando se habla de herramientas de clonado de disco (c\u00f3mo <code>dd</code>) y generalmente tambi\u00e9n de herramientas de snapshots nos referimos a este nivel.</p> <ul> <li>Ventajas: Copias exactas incluyendo sistema operativo, boot sectors, etc. R\u00e1pidas en full backups.</li> <li>Desventajas: Requieren espacio equivalente al original, no selectivas.</li> </ul> <p>El nivel l\u00f3gico es aquel que se hace a nivel fichero en s\u00ed. \"Copiar y Pegar\" los ficheros ser\u00eda un ejemplo de copia de seguridad a nivel l\u00f3gico.</p> <ul> <li>Ventajas: Selectivas, eficientes en espacio (en incremental), independientes del sistema de ficheros</li> <li>Desventajas: M\u00e1s lentas para conjuntos grandes de ficheros peque\u00f1os</li> </ul>"},{"location":"marco_teorico/metricas/","title":"M\u00e9tricas para backups","text":"<p>En esta secci\u00f3n se presentan algunas m\u00e9tricas habituales para entender c\u00f3mo se est\u00e1n comportando nuestras copias e identificar posibles problemas. Llamamos m\u00e9tricas a qu\u00e9 medir, y en la secci\u00f3n de monitorizaci\u00f3n y alertas hablamos de c\u00f3mo medirlo.</p> <p>Un sistema no necesita implementar todas las posibles m\u00e9tricas si no las m\u00e1s apropiadas al caso de uso.</p>"},{"location":"marco_teorico/metricas/#tasa-de-exito-de-backups","title":"Tasa de \u00e9xito de backups","text":"<p>El porcentaje de backups completados correctamente frente a los intentados. Deber\u00eda ser del 100%. Cualquier valor inferior requiere atenci\u00f3n inmediata. Esta m\u00e9trica da una visi\u00f3n r\u00e1pida de la fiabilidad general del sistema.</p> <p>Ejemplo en pseudo-c\u00f3digo:</p> <pre><code>total_backups=$(grep \"backup started\" /var/log/backup.log | wc -l)\nsuccessful_backups=$(grep \"backup completed successfully\" /var/log/backup.log | wc -l)\necho \"Tasa de \u00e9xito: $(($successful_backups * 100 / $total_backups))%\"\n</code></pre>"},{"location":"marco_teorico/metricas/#tiempo-de-ejecucion-del-backup","title":"Tiempo de ejecuci\u00f3n del backup","text":"<p>Cu\u00e1nto tarda en completarse cada proceso de backup. Esta m\u00e9trica puede alertar sobre degradaciones en el rendimiento o problemas emergentes.</p> <p>Adem\u00e1s permite medir si las copias se completan dentro del tiempo asignado (ventana de backup) sin afectar operaciones normales.</p>"},{"location":"marco_teorico/metricas/#tiempo-desde-el-ultimo-backup-exitoso","title":"Tiempo desde el \u00faltimo backup exitoso","text":"<p>M\u00e1s que una m\u00e9trica c\u00f3mo tal se trata de un par\u00e1metro cr\u00edtico de monitorizaci\u00f3n del sistema.</p> <p>Si el tiempo transcurrido es mayor al RPO deber\u00eda lanzarse una alerta.</p>"},{"location":"marco_teorico/metricas/#tamano-del-backup","title":"Tama\u00f1o del backup","text":"<p>Monitorizar el tama\u00f1o de los backups ayuda a planificar la capacidad de almacenamiento y puede alertar sobre anomal\u00edas. Un incremento o disminuci\u00f3n repentino en el tama\u00f1o puede indicar que algo no est\u00e1 funcionando correctamente.</p>"},{"location":"marco_teorico/metricas/#tasa-de-crecimiento","title":"Tasa de crecimiento","text":"<p>Asociado al tama\u00f1o del backup, mide la velocidad a la que crece el volumen de backups. Esta m\u00e9trica ayuda a planificar la capacidad futura de almacenamiento.</p> <p>Ejemplo en pseudo-c\u00f3digo:</p> <pre><code>Tasa de crecimiento = (Volumen actual - Volumen anterior) / Per\u00edodo de tiempo\n</code></pre>"},{"location":"marco_teorico/metricas/#uso-de-recursos-durante-backups","title":"Uso de recursos durante backups","text":"<p>CPU, memoria, I/O de disco y ancho de banda de red consumidos durante el proceso de backup. Permite minimizar el impacto del backup en el rendimiento de los sistemas.</p>"},{"location":"marco_teorico/metricas/#retencion-efectiva-vs-politica-definida","title":"Retenci\u00f3n efectiva vs. pol\u00edtica definida","text":"<p>Compara la retenci\u00f3n real con lo establecido en la pol\u00edtica.</p> <p>Ejemplo en pseudo-c\u00f3digo:</p> <pre><code>Conformidad de retenci\u00f3n = (Backups retenidos correctamente / Total backups) \u00d7 100%\n</code></pre>"},{"location":"marco_teorico/metricas/#tiempo-estimado-de-restauracion","title":"Tiempo estimado de restauraci\u00f3n","text":"<p>Una m\u00e9trica predictiva basada en pruebas peri\u00f3dicas que indica cu\u00e1nto se tarda en recuperar el sistema en caso de necesidad.</p> <p>Esta m\u00e9trica permite evaluar si se cumple el RTO.</p> <p>A veces se expresa c\u00f3mo el Tiempo medio de restauraci\u00f3n (MTTR - Mean Time To Recover):</p> <p>Ejemplo en pseudo-c\u00f3digo:</p> <pre><code>MTTR = Suma de tiempos de restauraci\u00f3n / N\u00famero de restauraciones\n</code></pre>"},{"location":"marco_teorico/metricas/#tasa-de-verificacion","title":"Tasa de verificaci\u00f3n","text":"<p>Porcentaje de backups que han sido verificados mediante pruebas de integridad.</p> <p>Ejemplo en pseudo-c\u00f3digo:</p> <pre><code>Tasa de verificaci\u00f3n = (Backups verificados / Total backups) \u00d7 100%\n</code></pre>"},{"location":"marco_teorico/metricas/#tasa-de-restauracion-exitosa","title":"Tasa de restauraci\u00f3n exitosa","text":"<p>Porcentaje de intentos de restauraci\u00f3n que funcionan correctamente. Es una m\u00e9trica importante, ya que mide directamente la eficacia real del sistema de backup.</p> <p>Ejemplo en pseudo-c\u00f3digo:</p> <pre><code>Tasa de restauraci\u00f3n = (Restauraciones exitosas / Intentos de restauraci\u00f3n) \u00d7 100%\n</code></pre>"},{"location":"marco_teorico/monitorizacion_alertas/","title":"Monitorizaci\u00f3n y Alertas","text":"<p>Las m\u00e9tricas definen que debemos medir. La monitorizaci\u00f3n nos ayuda a definir c\u00f3mo medirlo y visualizarlo. Las alertas son los avisos que debemos atender cuando hay problemas.</p> <p>Un sistema efectivo de monitorizaci\u00f3n debe cubrir diferentes aspectos:</p> <ul> <li>M\u00e9tricas a nivel ejecuci\u00f3n individual del backup (tarea)</li> <li>M\u00e9tricas a nivel sistema</li> <li>Env\u00edo de alertas</li> </ul>"},{"location":"marco_teorico/monitorizacion_alertas/#monitorizacion-a-nivel-de-tarea","title":"Monitorizaci\u00f3n a nivel de tarea","text":"<p>Supervisa cada operaci\u00f3n individual de backup:</p> <ul> <li>Logs detallados: Captura de inicio, finalizaci\u00f3n, errores y advertencias</li> <li>C\u00f3digos de salida: Verificaci\u00f3n program\u00e1tica del \u00e9xito</li> <li>Notificaciones: Alertas inmediatas sobre fallos</li> </ul> <p>En general la propia tarea de backup generar\u00e1 logs del proceso que enviar\u00e1 a un sistema de monitorizaci\u00f3n. Otra opci\u00f3n es que el log quede en el propio servidor y el sistema de monitorizaci\u00f3n se encargue de extraerlo pero no es lo ideal.</p> <p>La tarea tambi\u00e9n puede encargarse de enviar alertas, pero suele ser preferible que se deleguen al sistema de monitorizaci\u00f3n, que tambi\u00e9n debe avisar cuando no haya recibido una notificaci\u00f3n de backups dentro de la periodicidad programada.</p>"},{"location":"marco_teorico/monitorizacion_alertas/#monitorizacion-a-nivel-de-sistema","title":"Monitorizaci\u00f3n a nivel de sistema","text":"<p>Proporciona una vista agregada del estado de todos los backups:</p> <ul> <li>Dashboards: Visualizaci\u00f3n de m\u00e9tricas clave y tendencias</li> <li>Informes peri\u00f3dicos: Res\u00famenes diarios/semanales/mensuales</li> <li>An\u00e1lisis de tendencias: Identificaci\u00f3n de patrones problem\u00e1ticos</li> </ul> <p>El sistema recibe las m\u00e9tricas y logs de cada backup, los presenta de una forma agregada calculando las m\u00e9tricas establecidas, y env\u00eda alertas cuando resulte necesarios.</p>"},{"location":"marco_teorico/monitorizacion_alertas/#recoleccion-de-metricas","title":"Recolecci\u00f3n de m\u00e9tricas","text":"<p>Para entornos con m\u00faltiples servidores, la recolecci\u00f3n centralizada de m\u00e9tricas es esencial:</p> <ul> <li>Agentes de monitorizaci\u00f3n: Instalados en cada servidor para recopilar datos locales</li> <li>APIs: Interfaces program\u00e1ticas para extraer informaci\u00f3n de herramientas de backup</li> <li>Push vs Pull: Enviar los datos desde la propia tarea, o que el sistema de monitorizaci\u00f3n sea el responsable de ir a recogerlos.</li> <li>Externalizar: Soluciones self-hosted vs delegar en proveedores</li> </ul>"},{"location":"marco_teorico/monitorizacion_alertas/#alertas","title":"Alertas","text":"<p>El sistema de alertas debe equilibrar la informaci\u00f3n oportuna con la prevenci\u00f3n de la fatiga por alertas:</p>"},{"location":"marco_teorico/monitorizacion_alertas/#niveles-de-alerta-recomendados","title":"Niveles de alerta recomendados","text":"<p>Cr\u00edtico: Requiere acci\u00f3n inmediata</p> <ul> <li>Fallos de backup en sistemas de producci\u00f3n cr\u00edticos</li> <li>Superaci\u00f3n del RPO establecido</li> <li>Problemas de integridad detectados en backups</li> </ul> <p>Advertencia: Requiere atenci\u00f3n pronto</p> <ul> <li>Tendencia de crecimiento inusual</li> <li>Tiempo de backup aumentando significativamente</li> <li>Aproximaci\u00f3n a l\u00edmites de almacenamiento</li> </ul> <p>Informativo: Para seguimiento y mejora continua</p> <ul> <li>Res\u00famenes peri\u00f3dicos de estado</li> <li>Estad\u00edsticas de rendimiento</li> <li>Cumplimiento de pol\u00edticas</li> </ul>"},{"location":"marco_teorico/monitorizacion_alertas/#canales-de-notificacion","title":"Canales de notificaci\u00f3n","text":"<p>Diversificar seg\u00fan la urgencia y el tipo de alerta:</p> <ul> <li>Email para notificaciones no urgentes y res\u00famenes</li> <li>Sistemas de mensajer\u00eda o SMS para alertas importantes</li> <li>Tickets autom\u00e1ticos en sistemas de gesti\u00f3n</li> </ul>"},{"location":"marco_teorico/pitr/","title":"Point-In-Time Recovery (PITR)","text":"<p>Point-In-Time Recovery es la capacidad de restaurar un sistema al estado exacto en que se encontraba en cualquier momento dentro de una ventana temporal definida, no solo en los momentos espec\u00edficos donde se realizaron backups.</p> <p>Tradicionalmente, PITR se asocia con bases de datos, permitiendo recuperar el estado exacto de la base de datos al nivel de una transacci\u00f3n individual.</p> <p>El concepto se puede extender a otros \u00e1mbitos c\u00f3mo sistemas de archivos y entornos virtualizados:</p>"},{"location":"marco_teorico/pitr/#bases-de-datos","title":"Bases de datos","text":"<p>Se implementa mediante la combinaci\u00f3n de backups completos y logs de transacciones.</p> <p>En PostgreSQL se implementa combinando una base de de backups f\u00edsicos con la reproducci\u00f3n secuencial de los cambios registrados en el Write-Ahead Log (WAL) hasta el punto deseado.</p> <ul> <li>PostgreSQL Replication for Disaster Recovery</li> <li>Documentaci\u00f3n de PostgreSQL sobre PITR</li> </ul>"},{"location":"marco_teorico/pitr/#sistemas-de-archivos","title":"Sistemas de archivos","text":"<p>Se realiza mediante snapshots frecuentes o sistemas de versiones.</p> <p>Ejemplos:</p> <ul> <li>ZFS con snapshots frecuentes</li> <li>Btrfs con snapshots incrementales</li> </ul>"},{"location":"marco_teorico/pitr/#entornos-virtualizados","title":"Entornos virtualizados","text":"<p>Algunas plataformas de virtualizaci\u00f3n ofrecen capacidades similares a PITR:</p> <ul> <li>VMware con Changed Block Tracking</li> <li>Hyper-V con snapshots incrementales</li> <li>Proxmox con backup continuo</li> </ul>"},{"location":"marco_teorico/pitr/#pitr-y-su-relacion-con-las-politicas-de-retencion","title":"PITR y su relaci\u00f3n con las pol\u00edticas de retenci\u00f3n","text":"<p>PITR est\u00e1 relacionado, pero es distinto a las pol\u00edticas de retenci\u00f3n:</p> <ul> <li>Granularidad vs. extensi\u00f3n: La pol\u00edtica de retenci\u00f3n define cu\u00e1nto tiempo hacia atr\u00e1s podemos recuperar datos (extensi\u00f3n), mientras que PITR define la precisi\u00f3n con la que podemos seleccionar un momento espec\u00edfico dentro de esa ventana (granularidad).</li> <li>Ventana de PITR: Es el per\u00edodo durante el cual es posible realizar una recuperaci\u00f3n a cualquier punto en el tiempo. Esta ventana suele ser m\u00e1s corta que la pol\u00edtica de retenci\u00f3n completa.</li> </ul>"},{"location":"marco_teorico/pitr/#ejemplo-practico","title":"Ejemplo pr\u00e1ctico","text":"<p>Una pol\u00edtica de retenci\u00f3n podr\u00eda especificar:</p> <ul> <li>Ventana PITR: 7 d\u00edas (recuperaci\u00f3n a cualquier punto dentro de la \u00faltima semana)</li> <li>Granularidad PITR: 1 minuto</li> <li>Backups diarios: 30 d\u00edas</li> <li>Backups semanales: 3 meses</li> <li>Backups mensuales: 1 a\u00f1o</li> </ul> <p>En este caso, podemos recuperar a cualquier minuto dentro de los \u00faltimos 7 d\u00edas, pero m\u00e1s all\u00e1 de ese per\u00edodo, solo podemos recuperar a los puntos espec\u00edficos donde se realizaron backups.</p>"},{"location":"marco_teorico/pitr/#consideraciones-de-implementacion-para-pitr","title":"Consideraciones de implementaci\u00f3n para PITR","text":"<p>La implementaci\u00f3n de PITR requiere consideraciones especiales:</p> <ul> <li>Volumen de datos: Los logs de transacciones o cambios incrementales crecen significativamente en sistemas con mucha actividad.</li> <li>Rendimiento: La captura continua de cambios puede impactar el rendimiento del sistema.</li> <li>Complejidad de restauraci\u00f3n: La recuperaci\u00f3n a un punto espec\u00edfico puede requerir procesar numerosos archivos de logs o cambios incrementales.</li> <li>Pruebas de validaci\u00f3n: Es esencial verificar regularmente que la recuperaci\u00f3n a puntos arbitrarios funciona correctamente.</li> </ul>"},{"location":"marco_teorico/pitr/#integrando-pitr-en-una-politica-de-retencion-completa","title":"Integrando PITR en una pol\u00edtica de retenci\u00f3n completa","text":"<p>Para una estrategia que integre capacidades PITR habr\u00e1 que tener en cuenta:</p> <p>Definici\u00f3n de la ventana PITR:</p> <ul> <li>Evaluar el RPO (Recovery Point Objective) necesario</li> <li>Considerar el volumen de cambios y su impacto en almacenamiento</li> <li>Definir la granularidad temporal necesaria</li> </ul> <p>Configuraci\u00f3n de la pol\u00edtica de retenci\u00f3n para los componentes de PITR:</p> <ul> <li>Retenci\u00f3n de logs de transacciones o cambios incrementales</li> <li>Programaci\u00f3n de backups base que sirven como puntos de consolidaci\u00f3n</li> <li>Pol\u00edticas de purga autom\u00e1tica para los logs antiguos</li> </ul> <p>Documentaci\u00f3n clara de capacidades:</p> <ul> <li>Especificar qu\u00e9 sistemas tienen capacidad PITR y cu\u00e1les no</li> <li>Definir la ventana temporal de PITR para cada sistema</li> <li>Establecer procedimientos para solicitar y ejecutar recuperaciones a puntos espec\u00edficos</li> </ul>"},{"location":"marco_teorico/plan_recuperacion/","title":"Plan de recuperaci\u00f3n","text":"<p>El valor real de una copia de seguridad se materializa solamente cuando podemos recuperar los datos de manera efectiva. Un plan de recuperaci\u00f3n bien documentado es tan importante como la propia copia de seguridad.</p>"},{"location":"marco_teorico/plan_recuperacion/#principios-generales-de-restauracion","title":"Principios generales de restauraci\u00f3n","text":"<p>Antes de iniciar cualquier proceso de restauraci\u00f3n, es fundamental seguir estos principios:</p> <ol> <li> <p>Evaluaci\u00f3n del incidente: Determinar la causa y el alcance de la p\u00e9rdida de datos (error humano, fallo de hardware, ataque malicioso, etc.). Esto ayudar\u00e1 a decidir qu\u00e9 estrategia de recuperaci\u00f3n es la m\u00e1s adecuada.</p> </li> <li> <p>Priorizaci\u00f3n: Identificar qu\u00e9 servicios o datos deben ser restaurados primero bas\u00e1ndose en su criticidad para el negocio.</p> </li> <li> <p>Documentaci\u00f3n del proceso: Registrar cada paso realizado durante la restauraci\u00f3n, incluyendo tiempos, problemas encontrados y c\u00f3mo se resolvieron. Esta informaci\u00f3n ser\u00e1 valiosa para futuras restauraciones y para mejorar los procedimientos.</p> </li> <li> <p>Comunicaci\u00f3n: Mantener informados a los stakeholders sobre el progreso de la restauraci\u00f3n, proporcionando estimaciones realistas del tiempo necesario para completar el proceso.</p> </li> <li> <p>Revisi\u00f3n post-incidente: Despu\u00e9s de cada incidente</p> </li> <li> <p>Realizar una reuni\u00f3n de an\u00e1lisis con todas las partes involucradas</p> </li> <li>Documentar lo que funcion\u00f3 bien y lo que no</li> <li>Identificar cuellos de botella en el proceso</li> <li>Actualizar procedimientos basados en las lecciones aprendidas</li> </ol>"},{"location":"marco_teorico/plan_recuperacion/#documentacion-necesaria","title":"Documentaci\u00f3n necesaria","text":"<p>Una documentaci\u00f3n clara y accesible es vital durante la recuperaci\u00f3n. Debemos asegurarnos de que est\u00e9 disponible incluso cuando los sistemas principales est\u00e9n ca\u00eddos.</p>"},{"location":"marco_teorico/plan_recuperacion/#inventario-de-documentacion-requerida","title":"Inventario de documentaci\u00f3n requerida","text":"<ol> <li> <p>Cat\u00e1logo de copias de seguridad:</p> </li> <li> <p>Ubicaciones de almacenamiento (tanto primarias como secundarias)</p> </li> <li>Credenciales de acceso a los repositorios de backup</li> <li>Formatos y estructura de los archivos de backup</li> <li> <p>Pol\u00edtica de retenci\u00f3n aplicada</p> </li> <li> <p>Diagrama de infraestructura:</p> </li> <li> <p>Mapa de servidores y servicios</p> </li> <li>Dependencias entre sistemas</li> <li> <p>Puertos, direcciones IP y configuraciones de red</p> </li> <li> <p>Procedimientos paso a paso:</p> </li> <li> <p>Documentos detallados para cada tipo de restauraci\u00f3n</p> </li> <li>Comandos espec\u00edficos con explicaciones</li> <li> <p>\u00c1rboles de decisi\u00f3n para diferentes escenarios</p> </li> <li> <p>Contactos clave:</p> </li> <li> <p>Personal t\u00e9cnico interno con sus responsabilidades</p> </li> <li>Contactos de proveedores y soporte externo</li> <li> <p>Datos de clientes que deben ser informados en caso de incidentes</p> </li> <li> <p>Registro de contrase\u00f1as y credenciales:</p> </li> <li> <p>Accesos a sistemas operativos</p> </li> <li>Credenciales de bases de datos</li> <li>Claves de cifrado (si aplica)</li> </ol>"},{"location":"marco_teorico/plan_recuperacion/#formato-y-accesibilidad-de-la-documentacion","title":"Formato y accesibilidad de la documentaci\u00f3n","text":"<p>La documentaci\u00f3n no tiene que ser necesariamente \"texto\", si no que que puede estar contenida en las herramientas de restauraci\u00f3n. En todo caso es crucial que esta \"documentaci\u00f3n\" est\u00e9:</p> <ul> <li>Disponible offline: Copias impresas en ubicaciones seguras y copias digitales en dispositivos que no dependan de la infraestructura principal.</li> <li>Actualizada regularmente</li> <li>Escrita para momentos de estr\u00e9s: Instrucciones claras, concisas y con verificaci\u00f3n de pasos completados.</li> <li>Accesible a m\u00faltiples personas: Asegurar que no dependa de una \u00fanica persona para su interpretaci\u00f3n.</li> </ul>"},{"location":"marco_teorico/pruebas_restauracion/","title":"Pruebas de restauraci\u00f3n","text":"<p>Un sistema de backup no es verdaderamente efectivo hasta que podemos responder con certeza a la pregunta: \"\u00bfPuedo restaurar la copia?\". La monitorizaci\u00f3n y verificaci\u00f3n de las copias de seguridad es tan importante como la implementaci\u00f3n. Sin estas pr\u00e1cticas, podemos caer en una falsa sensaci\u00f3n de seguridad mientras nuestros sistemas fallan silenciosamente.</p> <p>La verificaci\u00f3n de backups es algo cr\u00edtico pero que suele ser descuidado en el sistema completo.</p> <p>Tener backups que no se pueden restaurar es equivalente a no tener backups.</p>"},{"location":"marco_teorico/pruebas_restauracion/#enfoques","title":"Enfoques","text":"<p>Las pruebas de restauraci\u00f3n pueden considerarse el nivel m\u00e1s alto y confiable del proceso de verificaci\u00f3n.</p> <p>Al igual que para el resto de procesos deber\u00edan recogerse m\u00e9tricas y estar en el sistema de monitorizaci\u00f3n.</p> <p>Las pruebas de restauraci\u00f3n pueden abordarse desde dos enfoques distintos:</p> <ul> <li>Pruebas de restauraci\u00f3n del backup. Se comprueba que los datos en s\u00ed son recuperables</li> <li>Pruebas de restauraci\u00f3n del sistema. Mayor nivel de confianza. Se comprueba que el sistema completo (no s\u00f3lo los datos) son recuperables en el tiempo definido por el RTO. Implica la realizaci\u00f3n de pruebas funcionales para verificar que la aplicaci\u00f3n funciona correctamente con los datos restaurados</li> </ul>"},{"location":"marco_teorico/pruebas_restauracion/#automatizacion-de-pruebas-de-restauracion","title":"Automatizaci\u00f3n de pruebas de restauraci\u00f3n","text":"<p>Las pruebas manuales son propensas a ser pospuestas y eventualmente olvidadas, por lo que las pruebas de restauraci\u00f3n deber\u00edan automatizarse.</p>"},{"location":"marco_teorico/pruebas_restauracion/#programacion-estrategica-de-pruebas","title":"Programaci\u00f3n estrat\u00e9gica de pruebas","text":"<p>Las pruebas de restauraci\u00f3n pueden programarse en base a distintos criterios. Por ejemplo:</p> <p>Frecuencia basada en criticidad:</p> <ul> <li>Sistemas cr\u00edticos: Pruebas de restauraci\u00f3n completa mensual o trimestral</li> <li>Sistemas est\u00e1ndar: Pruebas trimestrales o semestrales</li> <li>Sistemas no cr\u00edticos: Pruebas anuales</li> </ul> <p>Pruebas tras cambios significativos:</p> <ul> <li>Despu\u00e9s de actualizaciones importantes del software</li> <li>Tras cambios en la infraestructura</li> <li>Despu\u00e9s de modificaciones al sistema de backup</li> </ul>"},{"location":"marco_teorico/pruebas_restauracion/#proceso-de-pruebas","title":"Proceso de pruebas","text":"<ol> <li> <p>Planificaci\u00f3n:</p> </li> <li> <p>Definir el alcance de la prueba</p> </li> <li>Identificar los recursos necesarios</li> <li>Establecer criterios de \u00e9xito</li> <li> <p>Programar con anticipaci\u00f3n para minimizar impacto</p> </li> <li> <p>Ejecuci\u00f3n:</p> </li> <li> <p>Documentar cada paso realizado</p> </li> <li>Registrar tiempos de ejecuci\u00f3n</li> <li> <p>Anotar problemas encontrados</p> </li> <li> <p>Evaluaci\u00f3n:</p> </li> <li> <p>Comparar con los criterios de \u00e9xito establecidos</p> </li> <li>Identificar \u00e1reas de mejora</li> <li> <p>Documentar lecciones aprendidas</p> </li> <li> <p>Actualizaci\u00f3n de procedimientos:</p> </li> <li> <p>Incorporar mejoras basadas en los resultados</p> </li> <li>Actualizar la documentaci\u00f3n</li> <li>Revisar pol\u00edticas de backup si es necesario</li> </ol>"},{"location":"marco_teorico/pruebas_restauracion/#cultura-de-verificacion-continua","title":"Cultura de verificaci\u00f3n continua","text":"<p>M\u00e1s all\u00e1 de las herramientas y procesos, debe fomentarse una cultura organizacional que valore la verificaci\u00f3n:</p> <ul> <li>Responsabilidad compartida: Todo el equipo debe participar en la definici\u00f3n y revisi\u00f3n de las pruebas.</li> <li>Transparencia: Los resultados de las verificaciones deben ser visibles para todos los interesados.</li> <li>Mejora continua: Cada prueba de restauraci\u00f3n debe generar aprendizajes que mejoren tanto el proceso de backup como el de verificaci\u00f3n.</li> <li>Celebraci\u00f3n del fracaso controlado: Las pruebas que revelan problemas deben verse como \u00e9xitos, no como fracasos, ya que permiten corregir debilidades antes de emergencias reales.</li> <li>Simulaci\u00f3n de desastres: Realizar peri\u00f3dicamente un ejercicio de recuperaci\u00f3n ante desastres donde se simule un escenario de fallo completo y se siga el plan de recuperaci\u00f3n documentado. Esto puede ser complementando con simulacros no anunciados. Esto prueba no solo los aspectos t\u00e9cnicos sino tambi\u00e9n organizativos del plan de recuperaci\u00f3n.</li> </ul>"},{"location":"marco_teorico/pull_vs_push/","title":"Modelos de transferencia: Pull vs Push","text":""},{"location":"marco_teorico/pull_vs_push/#conceptos-fundamentales","title":"Conceptos fundamentales","text":"<p>Existen dos modelos principales para transferir los datos desde el origen hasta el sistema de almacenamiento de las copias:</p> <p>Pull: El sistema de backup es quien inicia y controla el proceso de copia, \"extrayendo\" los datos desde los servidores de origen. En este modelo, el sistema de backup act\u00faa como cliente y los servidores de origen como servidores de los datos.</p> <p>Push: Los servidores de origen son los que inician y controlan el proceso, \"enviando\" sus datos hacia el sistema de backup. En este modelo, los servidores de origen act\u00faan como clientes y el sistema de backup como servidor receptor de datos.</p>"},{"location":"marco_teorico/pull_vs_push/#modelo-pull","title":"Modelo Pull","text":"<p>Ventajas:</p> <ul> <li>Control centralizado: Todas las operaciones de backup se gestionan desde un \u00fanico punto, facilitando la programaci\u00f3n y supervisi\u00f3n.</li> <li>Mejor visibilidad: Es m\u00e1s f\u00e1cil verificar qu\u00e9 servidores han sido respaldados correctamente y cu\u00e1les no.</li> <li>Menor configuraci\u00f3n en servidores: Los servidores de origen requieren configuraci\u00f3n m\u00ednima, principalmente permisos de acceso para el servidor de backup.</li> <li>Recuperaci\u00f3n ante fallos: Si un servidor de origen falla antes de iniciar su backup, el sistema central a\u00fan puede intentarlo posteriormente.</li> </ul> <p>Desventajas:</p> <ul> <li>Superficie de ataque ampliada: El servidor de backup necesita credenciales para acceder a todos los servidores, convirti\u00e9ndose en un objetivo cr\u00edtico si es comprometido.</li> <li>Requisitos de conectividad: El servidor de backup debe tener acceso de red a todos los servidores de origen.</li> <li>Posible sobrecarga: El servidor de backup puede convertirse en cuello de botella al gestionar muchos backups simult\u00e1neos.</li> <li>Configuraci\u00f3n de firewall: Requiere apertura de puertos entrantes en los servidores de origen o configuraciones de VPN.</li> </ul> <p>Riesgos de seguridad:</p> <ul> <li>Credenciales centralizadas: El sistema de backup dispone de credenciales para acceder a todos los servidores, convirti\u00e9ndose en un punto cr\u00edtico.</li> <li>Vector de propagaci\u00f3n lateral: Un sistema de backup comprometido podr\u00eda utilizarse para acceder lateralmente a otros sistemas.</li> </ul>"},{"location":"marco_teorico/pull_vs_push/#modelo-push","title":"Modelo Push","text":"<p>Ventajas:</p> <ul> <li>Mayor seguridad: Los servidores de origen no necesitan permitir conexiones entrantes del sistema de backup.</li> <li>Mejor adaptaci\u00f3n a redes segmentadas: Funciona bien cuando los servidores est\u00e1n en redes distintas o protegidos por firewalls estrictos.</li> <li>Distribuci\u00f3n de carga: El procesamiento se distribuye entre todos los servidores de origen.</li> <li>Flexibilidad en la programaci\u00f3n: Cada servidor puede iniciar su backup en el momento m\u00e1s adecuado seg\u00fan su carga de trabajo.</li> </ul> <p>Desventajas:</p> <ul> <li>Gesti\u00f3n distribuida: La configuraci\u00f3n y supervisi\u00f3n est\u00e1n distribuidas, complicando la administraci\u00f3n.</li> <li>Dependencia del servidor de origen: Si el servidor sufre un compromiso severo, el atacante podr\u00eda tambi\u00e9n afectar al proceso de backup.</li> <li>Dificultad para verificar completitud: Es m\u00e1s complejo determinar si todos los servidores han realizado correctamente sus backups.</li> <li>Configuraci\u00f3n m\u00e1s compleja: Cada servidor debe configurarse individualmente.</li> </ul> <p>Riesgos de seguridad:</p> <ul> <li>Autenticaci\u00f3n del receptor: Es crucial verificar que los datos se env\u00edan al sistema de backup leg\u00edtimo (certificados, verificaci\u00f3n de claves).</li> <li>Denegaci\u00f3n de servicio: Un servidor comprometido podr\u00eda saturar el sistema de backup con datos fraudulentos.</li> </ul>"},{"location":"marco_teorico/pull_vs_push/#modelos-hibridos-y-avanzados","title":"Modelos h\u00edbridos y avanzados","text":""},{"location":"marco_teorico/pull_vs_push/#servidor-intermediario","title":"Servidor intermediario","text":"<p>Este enfoque utiliza un servidor intermedio que act\u00faa como puente entre los servidores de origen y el sistema de backup:</p> <ol> <li>Los servidores de origen env\u00edan (push) sus datos al servidor intermediario.</li> <li>El sistema de backup extrae (pull) los datos desde el servidor intermediario.</li> </ol> <p>Ventajas:</p> <ul> <li>Aislamiento de seguridad: El sistema de backup final no necesita acceso directo a los servidores productivos.</li> <li>Optimizaci\u00f3n de red: El servidor intermediario puede ubicarse estrat\u00e9gicamente para optimizar el tr\u00e1fico.</li> <li>Procesamiento adicional: El servidor intermediario puede realizar compresi\u00f3n, cifrado o verificaci\u00f3n antes de la transferencia final.</li> <li>Flexibilidad horaria: Los servidores pueden enviar backups a su conveniencia, y el sistema central los recoge posteriormente.</li> </ul> <p>Desventajas:</p> <ul> <li>Mayor complejidad y Punto adicional de fallo: Introduce otro componente que debe mantenerse y monitorizarse.</li> <li>Requisitos de almacenamiento intermedio: El servidor proxy necesita espacio suficiente para almacenar temporalmente todos los backups.</li> <li>Latencia adicional: El proceso requiere dos transferencias en lugar de una.</li> </ul>"},{"location":"marco_teorico/pull_vs_push/#push-only-append-envio-con-solo-adicion","title":"Push-Only-Append (Env\u00edo con solo adici\u00f3n)","text":"<p>Este modelo se enfoca en la seguridad permitiendo a los servidores de origen \u00fanicamente a\u00f1adir datos al sistema de backup, sin capacidad para modificar o eliminar backups anteriores:</p> <p>Ventajas:</p> <ul> <li>Protecci\u00f3n contra ransomware: Un servidor comprometido no puede eliminar o sobreescribir backups hist\u00f3ricos.</li> <li>Inmutabilidad de datos: Los backups antiguos permanecen inalterables, proporcionando una l\u00ednea de tiempo confiable.</li> <li>Simplificaci\u00f3n de permisos: Los servidores solo necesitan permisos para escribir, no para leer ni modificar datos existentes.</li> </ul> <p>Desventajas:</p> <ul> <li>La principal ventaja es la necesidad de una herramienta que soporte este modelo y que resta flexibilidad para implementar distintas caracter\u00edsticas</li> </ul>"},{"location":"marco_teorico/retencion/","title":"Pol\u00edticas de retenci\u00f3n de datos","text":"<p>La pol\u00edtica de retenci\u00f3n de datos son las reglas que determinan cu\u00e1nto tiempo se conservan las copias de seguridad antes de ser eliminadas. Esta pol\u00edtica define qu\u00e9 datos se conservan, por cu\u00e1nto tiempo y bajo qu\u00e9 condiciones.</p> <p>Las pol\u00edticas de retenci\u00f3n establecen un equilibrio entre varios factores:</p> <ul> <li>Disponibilidad de recuperaci\u00f3n: Durante cu\u00e1nto tiempo y granularidad podemos recuperar hist\u00f3ricos.</li> <li>Optimizaci\u00f3n de recursos: El espacio de almacenamiento y los costes asociados.</li> <li>Cumplimiento normativo: Requisitos legales sobre conservaci\u00f3n y eliminaci\u00f3n de datos.</li> </ul>"},{"location":"marco_teorico/retencion/#importancia-de-una-politica-de-retencion-bien-disenada","title":"Importancia de una pol\u00edtica de retenci\u00f3n bien dise\u00f1ada","text":"<p>Una pol\u00edtica de retenci\u00f3n adecuada no es simplemente una cuesti\u00f3n t\u00e9cnica, sino un componente estrat\u00e9gico en la gesti\u00f3n de datos por varias razones:</p>"},{"location":"marco_teorico/retencion/#impacto-en-costes-y-recursos","title":"Impacto en costes y recursos","text":"<p>Sin una pol\u00edtica clara, existe la tendencia natural a \"guardar todo por si acaso\", lo que lleva a:</p> <ul> <li>Crecimiento descontrolado del almacenamiento necesario</li> <li>Aumento continuo de costes</li> <li>Mayor complejidad en la gesti\u00f3n de los sistemas de backup</li> <li>Tiempos de restauraci\u00f3n m\u00e1s prolongados al tener que navegar por m\u00faltiples versiones</li> </ul>"},{"location":"marco_teorico/retencion/#aspectos-legales-y-de-cumplimiento","title":"Aspectos legales y de cumplimiento","text":"<p>Muchas regulaciones (GDPR, HIPAA, normativas sectoriales) tienen requisitos espec\u00edficos sobre:</p> <ul> <li>Per\u00edodos m\u00ednimos obligatorios de retenci\u00f3n</li> <li>Plazos m\u00e1ximos de conservaci\u00f3n</li> <li>M\u00e9todos de eliminaci\u00f3n segura</li> <li>Documentaci\u00f3n del ciclo de vida de los datos</li> </ul> <p>Un ejemplo concreto: GDPR requiere que los datos personales no se conserven m\u00e1s all\u00e1 de lo necesario para los fines para los que fueron recogidos, lo que implica la necesidad de pol\u00edticas de eliminaci\u00f3n programada.</p>"},{"location":"marco_teorico/retencion/#eficiencia-en-la-recuperacion","title":"Eficiencia en la recuperaci\u00f3n","text":"<p>La capacidad de recuperaci\u00f3n se optimiza cuando:</p> <ul> <li>Los puntos de restauraci\u00f3n est\u00e1n estrat\u00e9gicamente distribuidos en el tiempo</li> <li>Existe un equilibrio entre cantidad y antig\u00fcedad de backups</li> <li>Se evita la duplicaci\u00f3n innecesaria de datos hist\u00f3ricos</li> <li>Se prioriza la disponibilidad de los datos m\u00e1s relevantes</li> </ul>"},{"location":"marco_teorico/retencion/#modelos-comunes-de-politicas-de-retencion","title":"Modelos comunes de pol\u00edticas de retenci\u00f3n","text":"<p>Existen diferentes enfoques para estructurar una pol\u00edtica de retenci\u00f3n.</p>"},{"location":"marco_teorico/retencion/#1-politica-de-rotacion-basica-gfs-grandfather-father-son","title":"1. Pol\u00edtica de rotaci\u00f3n b\u00e1sica (GFS - Grandfather-Father-Son)","text":"<p>Este es uno de los modelos m\u00e1s utilizados. Est\u00e1 basado en una estructura jer\u00e1rquica:</p> <ul> <li>Copias diarias (Son): Se conservan durante 7-14 d\u00edas</li> <li>Copias semanales (Father): Se conservan durante 4-5 semanas</li> <li>Copias mensuales (Grandfather): Se conservan durante 12 meses</li> <li>Copias anuales: Se conservan durante 5-7 a\u00f1os (o seg\u00fan requisitos normativos)</li> </ul>"},{"location":"marco_teorico/retencion/#ejemplo-gfs","title":"Ejemplo GFS","text":"<p>Para un sistema con backups diarios, aplicando GFS podr\u00edamos tener:</p> <ul> <li>7 copias diarias (una semana completa)</li> <li>4 copias semanales (\u00faltimo backup de cada una de las 4 semanas anteriores)</li> <li>12 copias mensuales (\u00faltimo backup de cada uno de los 12 meses anteriores)</li> <li>5 copias anuales (\u00faltimo backup de cada uno de los 5 a\u00f1os anteriores)</li> </ul> <p>Esto proporciona 28 puntos de restauraci\u00f3n cubriendo un per\u00edodo de 5 a\u00f1os, pero con mayor densidad en el pasado reciente.</p>"},{"location":"marco_teorico/retencion/#2-politica-basada-en-valor-empresarial-vbr-value-based-retention","title":"2. Pol\u00edtica basada en valor empresarial (VBR - Value-Based Retention)","text":"<p>Este enfoque clasifica los datos seg\u00fan su importancia para el negocio:</p> <ul> <li>Datos cr\u00edticos: Mayor frecuencia de backup y per\u00edodos de retenci\u00f3n m\u00e1s largos</li> <li>Datos importantes: Frecuencia media y retenci\u00f3n est\u00e1ndar</li> <li>Datos rutinarios: Menor frecuencia y per\u00edodos cortos de retenci\u00f3n</li> </ul>"},{"location":"marco_teorico/retencion/#ejemplo-vbr","title":"Ejemplo VBR","text":"<ul> <li>Base de datos de transacciones: Backups cada 6 horas, retenci\u00f3n de 30 d\u00edas para copias diarias, 12 meses para mensuales</li> <li>Contenido de la web: Backups semanales, retenci\u00f3n de 2 semanas</li> <li>Logs del sistema: Backups diarios, retenci\u00f3n de 7 d\u00edas</li> </ul>"},{"location":"marco_teorico/retencion/#3-politica-de-retencion-logaritmica","title":"3. Pol\u00edtica de retenci\u00f3n logar\u00edtmica","text":"<p>Este modelo establece una distribuci\u00f3n no lineal de los puntos de restauraci\u00f3n, con mayor densidad en el pasado reciente y menor en el pasado distante:</p> <ul> <li>Todos los backups de la \u00faltima semana</li> <li>Una copia por semana del \u00faltimo mes</li> <li>Una copia por mes del \u00faltimo a\u00f1o</li> <li>Una copia por a\u00f1o para per\u00edodos anteriores</li> </ul> <p>Este enfoque optimiza el equilibrio entre cobertura temporal y eficiencia de almacenamiento.</p>"},{"location":"marco_teorico/retencion/#31-diferencia-entre-logaritmica-y-gfs","title":"3.1 Diferencia entre logar\u00edtmica y GFS","text":"<p>Las pol\u00edticas logar\u00edtmicas y GFS se comportan para muchas situaciones de forma similar. Para entender la diferencia se puede poner un ejemplo.</p> <p>En GFS haremos un backup todos los d\u00edas (<code>d1</code> a <code>d7</code>). El domingo la copia <code>d7</code> ser\u00e1 promocionada a semanal (<code>s1</code>), y si ya hab\u00eda un <code>s1</code> ser\u00e1 promocionada a <code>s2</code> (la copia de hace dos domingos). La <code>s4</code> (de hace 4 domingos) ser\u00e1 promocionada a mensual <code>m1</code>. Y as\u00ed sucesivamente, teniendo en cuenta que nunca habr\u00e1 un <code>d8</code> o un <code>s5</code>.</p> <p>En Logar\u00edtmico haremos un backup todos los d\u00edas (<code>d1</code> hasta <code>d&lt;infinito&gt;</code>). Tras el backup examinaremos todas las copias archivadas. Si tiene 0 d\u00edas (la de hoy) la conservamos. Las que tengan menos de 7 d\u00edas de antig\u00fcedad tambi\u00e9n las conservamos. Entre 7 y 30 conservaremos 5 copias equiespaciadas que no tendr\u00e1n porque ser las de los domingos.</p> <p>Ver el anexo para una descripci\u00f3n m\u00e1s amplia.</p>"},{"location":"marco_teorico/retencion/#consideraciones-practicas-para-implementar-politicas-de-retencion","title":"Consideraciones pr\u00e1cticas para implementar pol\u00edticas de retenci\u00f3n","text":""},{"location":"marco_teorico/retencion/#automatizacion-y-verificacion","title":"Automatizaci\u00f3n y verificaci\u00f3n","text":"<p>La implementaci\u00f3n efectiva requiere:</p> <ul> <li>Scripts o herramientas que apliquen autom\u00e1ticamente las reglas de retenci\u00f3n</li> <li>Mecanismos de verificaci\u00f3n que confirmen la correcta aplicaci\u00f3n</li> <li>Alertas ante anomal\u00edas o desviaciones de la pol\u00edtica</li> </ul>"},{"location":"marco_teorico/retencion/#documentacion-y-comunicacion","title":"Documentaci\u00f3n y comunicaci\u00f3n","text":"<p>Es esencial:</p> <ul> <li>Documentar claramente las pol\u00edticas para cada sistema</li> <li>Comunicar a stakeholders las capacidades y limitaciones</li> <li>Establecer procesos formales para solicitudes de restauraci\u00f3n</li> </ul>"},{"location":"marco_teorico/retencion/#revision-periodica","title":"Revisi\u00f3n peri\u00f3dica","text":"<p>Las pol\u00edticas deben revisarse regularmente:</p> <ul> <li>Evaluar si siguen cumpliendo con requisitos t\u00e9cnicos y normativos</li> <li>Ajustar seg\u00fan evoluci\u00f3n de las necesidades del negocio</li> <li>Adaptar a cambios tecnol\u00f3gicos o en infraestructura</li> </ul>"},{"location":"marco_teorico/rto_rpo/","title":"RTO (Recovery Time Objective) y RPO (Recovery Point Objective)","text":"<p>Estos son los dos par\u00e1metros m\u00e1s habituales que se manejan a alto nivel para dise\u00f1ar la estrategia de backup:</p> <p>RTO (Recovery Time Objective):</p> <ul> <li>Define cu\u00e1nto tiempo puede estar un sistema inoperativo</li> <li>Determina la velocidad necesaria de restauraci\u00f3n</li> <li>Se establece seg\u00fan el coste de inactividad del sistema</li> </ul> <p>RPO (Recovery Point Objective):</p> <ul> <li>Define cu\u00e1nta p\u00e9rdida de datos es aceptable</li> <li>Determina la frecuencia necesaria de backups</li> <li>Se establece seg\u00fan el valor de los datos generados por unidad de tiempo</li> </ul> <p>Por ejemplo:</p> <ul> <li>Un sistema cr\u00edtico financiero podr\u00eda requerir un RTO de 1 hora y un RPO de 5 minutos</li> <li>Un blog corporativo podr\u00eda tolerar un RTO de 24 horas y un RPO de 1 semana.</li> </ul> <p>La relaci\u00f3n entre estos par\u00e1metros y los costes es directa: reducir RTO y RPO incrementa significativamente la inversi\u00f3n necesaria en infraestructura y automatizaci\u00f3n.</p>"},{"location":"marco_teorico/rto_rpo/#referencias","title":"Referencias","text":"<ul> <li>Qu\u00e9 es RPO y RTO</li> </ul>"},{"location":"marco_teorico/segmentar_fuente/","title":"Segmentar las fuentes de datos","text":"<p>A pesar de haber sido tratado en otras secciones debe hacerse hincapi\u00e9 en que no toda la informaci\u00f3n de origen tiene el mismo valor y caracter\u00edsticas.</p> <p>La estrategia de copias puede tenerlo en cuenta para optimizar recursos. A sabiendas de que introducir mecanismos distintos seg\u00fan el conjunto de datos complicar\u00e1 el sistema general.</p> <p>Este an\u00e1lisis se puede hacer desde el punto de vista de la \"criticidad\" pero complementariamente se puede hacer una clasificaci\u00f3n por tipo u objetivo del dato.</p>"},{"location":"marco_teorico/segmentar_fuente/#tipos-de-datos-para-backup","title":"Tipos de datos para backup","text":""},{"location":"marco_teorico/segmentar_fuente/#aplicacion-binarios-configuracion-etc","title":"Aplicaci\u00f3n, Binarios, Configuraci\u00f3n, etc","text":"<p>Salvo que usemos un sistema de clonado no deber\u00edamos preocuparnos por esta informaci\u00f3n. La restauraci\u00f3n del sistema a este nivel, deber\u00eda poder ser realizada con los mismos automatismos que usemos para el provisionamiento.</p> <p>A\u00fan as\u00ed el esfuerzo de copiar ciertos datos c\u00f3mo <code>/etc/</code> o un listado de los paquetes instalados en el sistema (<code>apt list --installed</code>) tiene un coste reducido y puede ahorrar problemas.</p>"},{"location":"marco_teorico/segmentar_fuente/#configuracion","title":"Configuraci\u00f3n","text":"<ul> <li>Caracter\u00edsticas: Crucial para la operaci\u00f3n, volumen peque\u00f1o</li> <li>Ejemplos: Archivos de configuraci\u00f3n en /etc, virtualhosts de Apache</li> <li>Consideraciones especiales:<ul> <li>Idealmente gestionada como Infrastructure as Code</li> <li>Backup tras cambios planificados</li> <li>Documentaci\u00f3n de cambios manuales</li> </ul> </li> </ul>"},{"location":"marco_teorico/segmentar_fuente/#codigo-de-aplicacion","title":"C\u00f3digo de aplicaci\u00f3n","text":"<ul> <li>Caracter\u00edsticas: Debe estar versionado en repositorio</li> <li>Consideraciones especiales:<ul> <li>No requiere backup tradicional si existen mecanismos de despliegue apropiados</li> </ul> </li> </ul>"},{"location":"marco_teorico/segmentar_fuente/#bases-de-datos","title":"Bases de datos","text":"<p>Es uno de los activos que claramente habr\u00e1 que respaldar.</p> <ul> <li>Caracter\u00edsticas: Almac\u00e9n central de informaci\u00f3n, acceso constante</li> <li>Consideraciones especiales:<ul> <li>Consistencia transaccional</li> <li>Herramientas espec\u00edficas seg\u00fan motor (pg_dump, pg_basebackup)</li> <li>Balance entre backups l\u00f3gicos y f\u00edsicos</li> <li>Integraci\u00f3n con logs transaccionales para PITR</li> </ul> </li> </ul>"},{"location":"marco_teorico/segmentar_fuente/#ficheros-grandes-de-larga-duracion-big-long-term-files","title":"Ficheros grandes de larga duraci\u00f3n (Big long term files)","text":"<p>En aplicaciones corporativas son muchas veces ficheros que se proveen con la propia aplicaci\u00f3n y no informaci\u00f3n que modifica el cliente. Muchas veces pueden ser \"recreados\" por lo que los backups est\u00e1n m\u00e1s relacionados con el RTO qu\u00e9 con la p\u00e9rdida de datos.</p> <ul> <li>Caracter\u00edsticas: Voluminosos (decenas o cientos de GB), raramente modificados</li> <li>Ejemplos: Datos r\u00e1ster para GIS, MDTs para geoprocesos, datasets de machine learning</li> <li>Consideraciones especiales:<ul> <li>La estrategia inicial debe ser un backup completo</li> <li>Backups incrementales o diferenciales muy espaciados</li> <li>Verificaci\u00f3n de integridad especialmente importante</li> <li>Posible almacenamiento en medios de menor coste</li> </ul> </li> </ul>"},{"location":"marco_teorico/segmentar_fuente/#ficheros-de-corta-duracion-short-term-files","title":"Ficheros de corta duraci\u00f3n (Short term files)","text":"<p>Lo que en aplicaciones corporativas puede denominarse adjuntos. Estos ficheros son muchas veces tan cr\u00edticos c\u00f3mo la base de datos y est\u00e1n muy ligadas a ella, por lo que deber\u00edan tener las mismas pol\u00edticas de periodicidad y retenci\u00f3n.</p> <ul> <li>Caracter\u00edsticas: Modificados frecuentemente, tama\u00f1o variable</li> <li>Ejemplos: Archivos subidos por usuarios, documentos en edici\u00f3n activa</li> <li>Consideraciones especiales:<ul> <li>Backups frecuentes</li> <li>Estrategias incrementales o diferenciales</li> <li>Posible necesidad de versionado</li> </ul> </li> </ul>"},{"location":"marco_teorico/segmentar_fuente/#contenedores-docker","title":"Contenedores (docker)","text":"<p>Los contenedores podr\u00edan tratarse de forma especial pero es m\u00e1s sencillo gestionarlo c\u00f3mo los otros tipos: Configuraci\u00f3n, Binarios, Bases de Datos y Ficheros. Simplemente hay que tener precauci\u00f3n con los vol\u00famenes y gestionarlos como IaC.</p>"},{"location":"marco_teorico/seguridad/","title":"Modelo de Amenaza y Seguridad","text":""},{"location":"marco_teorico/seguridad/#que-es-un-modelo-de-amenaza","title":"\u00bfQu\u00e9 es un modelo de amenaza?","text":"<p>Un modelo de amenaza (o threat model) es un ejercicio de an\u00e1lisis que permite identificar y evaluar las posibles amenazas a la seguridad de un sistema. En el contexto de las copias de seguridad, un modelo de amenaza nos ayuda a entender qu\u00e9 adversarios podr\u00edan querer atacar nuestro sistema de copias de seguridad, cu\u00e1les son sus objetivos y qu\u00e9 vulnerabilidades podr\u00edan explotar.</p> <p>El objetivo no es crear un sistema 100% invulnerable, lo cual es imposible, sino entender los riesgos y dise\u00f1ar un sistema que ofrezca un nivel de seguridad adecuado a las necesidades de la organizaci\u00f3n, equilibrando seguridad, coste y usabilidad.</p> <p>Dos ejemplos de modelos de amenaza bien definidos son los de BorgBackup y Restic.</p>"},{"location":"marco_teorico/seguridad/#principios-de-seguridad-en-las-copias-de-seguridad","title":"Principios de seguridad en las copias de seguridad","text":"<ul> <li> <p>Confidencialidad: La informaci\u00f3n almacenada en las copias de seguridad no debe ser accesible a personal no autorizado. El cifrado es la principal herramienta para garantizar la confidencialidad. Si un atacante consigue acceso al repositorio de backups, no deber\u00eda poder leer los datos.</p> </li> <li> <p>Integridad: Las copias de seguridad deben ser una representaci\u00f3n fiel de los datos originales. No deben poder ser modificadas sin que nos demos cuenta. Las herramientas de backup modernas utilizan t\u00e9cnicas como los c\u00f3digos de autenticaci\u00f3n de mensajes (MAC) para garantizar que los datos no han sido alterados.</p> </li> <li> <p>Disponibilidad: Los datos deben estar disponibles para ser restaurados cuando sea necesario. Esto implica proteger los backups contra borrados accidentales o maliciosos, y tener un plan de recuperaci\u00f3n probado y fiable.</p> </li> </ul>"},{"location":"marco_teorico/seguridad/#modelos-de-amenaza-en-la-practica","title":"Modelos de amenaza en la pr\u00e1ctica","text":"<p>Tanto <code>borg</code> como <code>restic</code> dise\u00f1an su seguridad partiendo de la base de que el cliente (la m\u00e1quina que se est\u00e1 copiando) es seguro, pero el servidor (donde se guardan las copias) no lo es.</p> <p>Esto tiene implicaciones importantes:</p> <ul> <li>El cifrado se realiza en el cliente: Los datos nunca abandonan la m\u00e1quina de origen sin estar cifrados. La clave de cifrado nunca se env\u00eda al servidor.</li> <li>La integridad se verifica en el cliente: El cliente puede detectar si los datos en el servidor han sido modificados o corrompidos.</li> <li>Un atacante con acceso al servidor no puede:<ul> <li>Leer el contenido de los backups.</li> <li>Modificar los backups existentes sin que el cliente lo detecte en la siguiente operaci\u00f3n.</li> <li>Inyectar datos maliciosos en los backups.</li> </ul> </li> </ul> <p>Sin embargo, un atacante con acceso al servidor s\u00ed podr\u00eda:</p> <ul> <li>Borrar o Modificar los backups (ransomware): Es la amenaza m\u00e1s dif\u00edcil de mitigar. Si un atacante tiene control total del servidor, puede borrar todo el repositorio. Para evitarlo, se pueden usar pol\u00edticas de retenci\u00f3n inmutables (append-only) en el almacenamiento si el proveedor lo permite.</li> <li>Realizar ataques de denegaci\u00f3n de servicio (DoS): Podr\u00eda impedir que se realicen nuevas copias o que se restauren las existentes.</li> <li>Analizar metadatos: Aunque no pueda leer los datos, podr\u00eda inferir informaci\u00f3n a partir de los metadatos, como el tama\u00f1o de los ficheros, la frecuencia de los cambios, etc.</li> </ul>"},{"location":"marco_teorico/verificacion/","title":"Verificaci\u00f3n","text":"<p>La verificaci\u00f3n est\u00e1 muy relacionado con las m\u00e9tricas y c\u00f3mo ellas forma parte de la monitorizaci\u00f3n. Las m\u00e9tricas est\u00e1n m\u00e1s enfocadas a una panor\u00e1mica general, mientras que la verificaci\u00f3n est\u00e1 enfocada a que la replica en destino es la esperada.</p> <p>Conceptualmente la verificaci\u00f3n deber\u00eda implementarse a varios niveles, cada uno proporcionando diferentes grados de confianza. Pero en general la verificaci\u00f3n se delega a las opciones que tenga la herramienta de backups que se emplee.</p> <p>La verificaci\u00f3n no tiene porqu\u00e9 ser un proceso asociado \u00fanicamente a una tarea concreta. Si no que puede implicar que a\u00fan existen las copias previas y no han sido alteradas.</p>"},{"location":"marco_teorico/verificacion/#verificacion-de-completitud","title":"Verificaci\u00f3n de completitud","text":"<p>Este nivel b\u00e1sico confirma que el proceso de backup ha finalizado y ha generado los archivos esperados:</p> <p>Por ejemplo:</p> <ul> <li>Validaci\u00f3n de tama\u00f1o: El tama\u00f1o del backup est\u00e1 dentro del rango esperado.</li> <li>Conteo de archivos: El n\u00famero de archivos o elementos es el esperado.</li> </ul>"},{"location":"marco_teorico/verificacion/#verificacion-de-integridad","title":"Verificaci\u00f3n de integridad","text":"<p>Este nivel intermedio confirma que los datos respaldados no est\u00e1n corruptos:</p> <p>Por ejemplo:</p> <ul> <li>Checksums: Generaci\u00f3n y verificaci\u00f3n de hashes criptogr\u00e1ficos (MD5, SHA-256, etc.)</li> <li>Verificaci\u00f3n estructural: Comprobaci\u00f3n de la integridad del formato del archivo de backup</li> </ul>"},{"location":"marco_teorico/verificacion/#verificacion-de-contenido","title":"Verificaci\u00f3n de contenido","text":"<p>Este nivel avanzado confirma que los datos espec\u00edficos que deb\u00edan ser respaldados est\u00e1n presentes y son correctos:</p> <p>Por ejemplo:</p> <ul> <li>Muestreo aleatorio: Extracci\u00f3n y verificaci\u00f3n de archivos seleccionados aleatoriamente</li> <li>An\u00e1lisis estructural: Para datos complejos como bases de datos, confirmaci\u00f3n de la coherencia interna</li> </ul>"},{"location":"marco_teorico/verificacion/#periodicidad","title":"Periodicidad","text":"<p>Algunas pruebas de verificaci\u00f3n son computacionalmente costosas por lo que tambi\u00e9n debe establecerse la periodicidad adecuada para ellas:</p> <p>Por ejemplo:</p> <ul> <li>Verificaci\u00f3n de integridad (checksums): Con cada backup o semanal</li> <li>Verificaci\u00f3n de contenido (muestreo): Mensual</li> </ul>"}]}